var read_,readAsync,readBinary,setWindowTitle,fs,nodePath,requireNodeFS,wasmBinary,wasmMemory,EXITSTATUS,buffer,HEAP8,HEAPU8,HEAP16,HEAPU16,HEAP32,HEAPU32,HEAPF32,HEAPF64,wasmTable,wasmBinaryFile,tempDouble,tempI64,_emscripten_get_now,GLctx,calledRun,Module=void 0!==Module?Module:{},objAssign=Object.assign,moduleOverrides=objAssign({},Module),arguments_=[],thisProgram="./this.program",quit_=(e,t)=>{throw t},ENVIRONMENT_IS_WEB="object"==typeof window,ENVIRONMENT_IS_WORKER="function"==typeof importScripts,ENVIRONMENT_IS_NODE="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,scriptDirectory="";function locateFile(e){return Module.locateFile?Module.locateFile(e,scriptDirectory):scriptDirectory+e}function logExceptionOnExit(e){!(e instanceof ExitStatus)&&err("exiting due to exception: "+e)}ENVIRONMENT_IS_NODE?(scriptDirectory=ENVIRONMENT_IS_WORKER?require("path").dirname(scriptDirectory)+"/":__dirname+"/",requireNodeFS=function(){nodePath||(fs=require("fs"),nodePath=require("path"))},read_=function e(t,r){return requireNodeFS(),t=nodePath.normalize(t),fs.readFileSync(t,r?null:"utf8")},readBinary=function e(t){var r=read_(t,!0);return r.buffer||(r=new Uint8Array(r)),r},readAsync=function e(t,r,n){requireNodeFS(),t=nodePath.normalize(t),fs.readFile(t,function(e,t){e?n(e):r(t.buffer)})},process.argv.length>1&&(thisProgram=process.argv[1].replace(/\\/g,"/")),arguments_=process.argv.slice(2),"undefined"!=typeof module&&(module.exports=Module),process.on("uncaughtException",function(e){if(!(e instanceof ExitStatus))throw e}),process.on("unhandledRejection",function(e){throw e}),quit_=(e,t)=>{if(keepRuntimeAlive())throw process.exitCode=e,t;logExceptionOnExit(t),process.exit(e)},Module.inspect=function(){return"[Emscripten Module object]"}):(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)&&(ENVIRONMENT_IS_WORKER?scriptDirectory=self.location.href:"undefined"!=typeof document&&document.currentScript&&(scriptDirectory=document.currentScript.src),scriptDirectory=0!==scriptDirectory.indexOf("blob:")?scriptDirectory.substr(0,scriptDirectory.replace(/[?#].*/,"").lastIndexOf("/")+1):"",read_=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},ENVIRONMENT_IS_WORKER&&(readBinary=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),readAsync=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200==n.status||0==n.status&&n.response){t(n.response);return}r()},n.onerror=r,n.send(null)},setWindowTitle=e=>document.title=e);var out=Module.print||console.log.bind(console),err=Module.printErr||console.warn.bind(console);function warnOnce(e){warnOnce.shown||(warnOnce.shown={}),warnOnce.shown[e]||(warnOnce.shown[e]=1,err(e))}objAssign(Module,moduleOverrides),moduleOverrides=null,Module.arguments&&(arguments_=Module.arguments),Module.thisProgram&&(thisProgram=Module.thisProgram),Module.quit&&(quit_=Module.quit),Module.wasmBinary&&(wasmBinary=Module.wasmBinary);var noExitRuntime=Module.noExitRuntime||!0;"object"!=typeof WebAssembly&&abort("no native wasm support detected");var ABORT=!1;function assert(e,t){e||abort(t)}var UTF8Decoder="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function UTF8ArrayToString(e,t,r){for(var n=t+r,o=t;e[o]&&!(o>=n);)++o;if(o-t>16&&e.subarray&&UTF8Decoder)return UTF8Decoder.decode(e.subarray(t,o));for(var i="";t<o;){var a=e[t++];if(!(128&a)){i+=String.fromCharCode(a);continue}var s=63&e[t++];if((224&a)==192){i+=String.fromCharCode((31&a)<<6|s);continue}var u=63&e[t++];if((a=(240&a)==224?(15&a)<<12|s<<6|u:(7&a)<<18|s<<12|u<<6|63&e[t++])<65536)i+=String.fromCharCode(a);else{var l=a-65536;i+=String.fromCharCode(55296|l>>10,56320|1023&l)}}return i}function UTF8ToString(e,t){return e?UTF8ArrayToString(HEAPU8,e,t):""}function stringToUTF8Array(e,t,r,n){if(!(n>0))return 0;for(var o=r,i=r+n-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),s<=127){if(r>=i)break;t[r++]=s}else if(s<=2047){if(r+1>=i)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=i)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=i)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-o}function stringToUTF8(e,t,r){return stringToUTF8Array(e,HEAPU8,t,r)}function lengthBytesUTF8(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:n<=2047?t+=2:n<=65535?t+=3:t+=4}return t}function allocateUTF8OnStack(e){var t=lengthBytesUTF8(e)+1,r=stackAlloc(t);return stringToUTF8Array(e,HEAP8,r,t),r}function writeArrayToMemory(e,t){HEAP8.set(e,t)}function writeAsciiToMemory(e,t,r){for(var n=0;n<e.length;++n)HEAP8[t++>>0]=e.charCodeAt(n);r||(HEAP8[t>>0]=0)}function updateGlobalBufferAndViews(e){buffer=e,Module.HEAP8=HEAP8=new Int8Array(e),Module.HEAP16=HEAP16=new Int16Array(e),Module.HEAP32=HEAP32=new Int32Array(e),Module.HEAPU8=HEAPU8=new Uint8Array(e),Module.HEAPU16=HEAPU16=new Uint16Array(e),Module.HEAPU32=HEAPU32=new Uint32Array(e),Module.HEAPF32=HEAPF32=new Float32Array(e),Module.HEAPF64=HEAPF64=new Float64Array(e)}var INITIAL_MEMORY=Module.INITIAL_MEMORY||16777216,__ATPRERUN__=[],__ATINIT__=[],__ATMAIN__=[],__ATEXIT__=[],__ATPOSTRUN__=[],runtimeInitialized=!1,runtimeExited=!1,runtimeKeepaliveCounter=0;function keepRuntimeAlive(){return noExitRuntime||runtimeKeepaliveCounter>0}function preRun(){if(Module.preRun)for("function"==typeof Module.preRun&&(Module.preRun=[Module.preRun]);Module.preRun.length;)addOnPreRun(Module.preRun.shift());callRuntimeCallbacks(__ATPRERUN__)}function initRuntime(){runtimeInitialized=!0,Module.noFSInit||FS.init.initialized||FS.init(),FS.ignorePermissions=!1,TTY.init(),callRuntimeCallbacks(__ATINIT__)}function preMain(){callRuntimeCallbacks(__ATMAIN__)}function exitRuntime(){runtimeExited=!0}function postRun(){if(Module.postRun)for("function"==typeof Module.postRun&&(Module.postRun=[Module.postRun]);Module.postRun.length;)addOnPostRun(Module.postRun.shift());callRuntimeCallbacks(__ATPOSTRUN__)}function addOnPreRun(e){__ATPRERUN__.unshift(e)}function addOnInit(e){__ATINIT__.unshift(e)}function addOnPostRun(e){__ATPOSTRUN__.unshift(e)}var runDependencies=0,runDependencyWatcher=null,dependenciesFulfilled=null;function getUniqueRunDependency(e){return e}function addRunDependency(e){runDependencies++,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies)}function removeRunDependency(e){if(runDependencies--,Module.monitorRunDependencies&&Module.monitorRunDependencies(runDependencies),0==runDependencies&&(null!==runDependencyWatcher&&(clearInterval(runDependencyWatcher),runDependencyWatcher=null),dependenciesFulfilled)){var t=dependenciesFulfilled;dependenciesFulfilled=null,t()}}function abort(e){throw Module.onAbort&&Module.onAbort(e),err(e="Aborted("+e+")"),ABORT=!0,EXITSTATUS=1,e+=". Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}Module.preloadedImages={},Module.preloadedAudios={};var dataURIPrefix="data:application/octet-stream;base64,";function isDataURI(e){return e.startsWith(dataURIPrefix)}function isFileURI(e){return e.startsWith("file://")}function getBinary(e){try{if(e==wasmBinaryFile&&wasmBinary)return new Uint8Array(wasmBinary);if(readBinary)return readBinary(e);throw"both async and sync fetching of the wasm failed"}catch(t){abort(t)}}function getBinaryPromise(){if(!wasmBinary&&(ENVIRONMENT_IS_WEB||ENVIRONMENT_IS_WORKER)){if("function"==typeof fetch&&!isFileURI(wasmBinaryFile))return fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+wasmBinaryFile+"'";return e.arrayBuffer()}).catch(function(){return getBinary(wasmBinaryFile)});if(readAsync)return new Promise(function(e,t){readAsync(wasmBinaryFile,function(t){e(new Uint8Array(t))},t)})}return Promise.resolve().then(function(){return getBinary(wasmBinaryFile)})}function createWasm(){var e={a:asmLibraryArg};function t(e,t){var r=e.exports;Module.asm=r,updateGlobalBufferAndViews((wasmMemory=Module.asm.V).buffer),wasmTable=Module.asm.$,addOnInit(Module.asm.W),removeRunDependency("wasm-instantiate")}function r(e){t(e.instance)}function n(t){return getBinaryPromise().then(function(t){return WebAssembly.instantiate(t,e)}).then(function(e){return e}).then(t,function(e){err("failed to asynchronously prepare wasm: "+e),abort(e)})}if(addRunDependency("wasm-instantiate"),Module.instantiateWasm)try{return Module.instantiateWasm(e,t)}catch(o){return err("Module.instantiateWasm callback failed with error: "+o),!1}return wasmBinary||"function"!=typeof WebAssembly.instantiateStreaming||isDataURI(wasmBinaryFile)||isFileURI(wasmBinaryFile)||"function"!=typeof fetch?n(r):fetch(wasmBinaryFile,{credentials:"same-origin"}).then(function(t){return WebAssembly.instantiateStreaming(t,e).then(r,function(e){return err("wasm streaming compile failed: "+e),err("falling back to ArrayBuffer instantiation"),n(r)})}),{}}function callRuntimeCallbacks(e){for(;e.length>0;){var t=e.shift();if("function"==typeof t){t(Module);continue}var r=t.func;"number"==typeof r?void 0===t.arg?getWasmTableEntry(r)():getWasmTableEntry(r)(t.arg):r(void 0===t.arg?null:t.arg)}}isDataURI(wasmBinaryFile="APIC2D.wasm")||(wasmBinaryFile=locateFile(wasmBinaryFile));var wasmTableMirror=[];function getWasmTableEntry(e){var t=wasmTableMirror[e];return t||(e>=wasmTableMirror.length&&(wasmTableMirror.length=e+1),wasmTableMirror[e]=t=wasmTable.get(e)),t}function handleException(e){if(e instanceof ExitStatus||"unwind"==e)return EXITSTATUS;quit_(1,e)}function _abort(){abort("")}_emscripten_get_now=ENVIRONMENT_IS_NODE?()=>{var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:()=>performance.now();var _emscripten_get_now_is_monotonic=!0;function setErrNo(e){return HEAP32[___errno_location()>>2]=e,e}function _clock_gettime(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e||!_emscripten_get_now_is_monotonic)return setErrNo(28),-1;r=_emscripten_get_now()}return HEAP32[t>>2]=r/1e3|0,HEAP32[t+4>>2]=r%1e3*1e6|0,0}function _emscripten_memcpy_big(e,t,r){HEAPU8.copyWithin(e,t,t+r)}function abortOnCannotGrowMemory(e){abort("OOM")}function _emscripten_resize_heap(e){HEAPU8.length,abortOnCannotGrowMemory(e>>>=0)}var ENV={};function getExecutableName(){return thisProgram||"./this.program"}function getEnvStrings(){if(!getEnvStrings.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:getExecutableName()};for(var t in ENV)void 0===ENV[t]?delete e[t]:e[t]=ENV[t];var r=[];for(var t in e)r.push(t+"="+e[t]);getEnvStrings.strings=r}return getEnvStrings.strings}var PATH={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var r=0,n=e.length-1;n>=0;n--){var o=e[n];"."===o?e.splice(n,1):".."===o?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),r="/"===e.substr(-1);return(e=PATH.normalizeArray(e.split("/").filter(function(e){return!!e}),!t).join("/"))||t||(e="."),e&&r&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=PATH.splitPath(e),r=t[0],n=t[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},basename:function(e){if("/"===e)return"/";var t=(e=(e=PATH.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return -1===t?e:e.substr(t+1)},extname:function(e){return PATH.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return PATH.normalize(e.join("/"))},join2:function(e,t){return PATH.normalize(e+"/"+t)}};function getRandomDevice(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}if(ENVIRONMENT_IS_NODE)try{var t=require("crypto");return function(){return t.randomBytes(1)[0]}}catch(r){}return function(){abort("randomDevice")}}var PATH_FS={resolve:function(){for(var e="",t=!1,r=arguments.length-1;r>=-1&&!t;r--){var n=r>=0?arguments[r]:FS.cwd();if("string"!=typeof n)throw TypeError("Arguments to path.resolve must be strings");if(!n)return"";e=n+"/"+e,t="/"===n.charAt(0)}return e=PATH.normalizeArray(e.split("/").filter(function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."},relative:function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=PATH_FS.resolve(e).substr(1),t=PATH_FS.resolve(t).substr(1);for(var n=r(e.split("/")),o=r(t.split("/")),i=Math.min(n.length,o.length),a=i,s=0;s<i;s++)if(n[s]!==o[s]){a=s;break}for(var u=[],s=a;s<n.length;s++)u.push("..");return(u=u.concat(o.slice(a))).join("/")}},TTY={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){TTY.ttys[e]={input:[],output:[],ops:t},FS.registerDevice(e,TTY.stream_ops)},stream_ops:{open:function(e){var t=TTY.ttys[e.node.rdev];if(!t)throw new FS.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(e,t,r,n,o){if(!e.tty||!e.tty.ops.get_char)throw new FS.ErrnoError(60);for(var i,a=0,s=0;s<n;s++){try{i=e.tty.ops.get_char(e.tty)}catch(u){throw new FS.ErrnoError(29)}if(void 0===i&&0===a)throw new FS.ErrnoError(6);if(null==i)break;a++,t[r+s]=i}return a&&(e.node.timestamp=Date.now()),a},write:function(e,t,r,n,o){if(!e.tty||!e.tty.ops.put_char)throw new FS.ErrnoError(60);try{for(var i=0;i<n;i++)e.tty.ops.put_char(e.tty,t[r+i])}catch(a){throw new FS.ErrnoError(29)}return n&&(e.node.timestamp=Date.now()),i}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if(ENVIRONMENT_IS_NODE){var r=Buffer.alloc(256),n=0;try{n=fs.readSync(process.stdin.fd,r,0,256,null)}catch(o){if(o.toString().includes("EOF"))n=0;else throw o}t=n>0?r.slice(0,n).toString("utf-8"):null}else"undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n");if(!t)return null;e.input=intArrayFromString(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(out(UTF8ArrayToString(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(out(UTF8ArrayToString(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(err(UTF8ArrayToString(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(err(UTF8ArrayToString(e.output,0)),e.output=[])}}};function mmapAlloc(e){abort()}var MEMFS={ops_table:null,mount:function(e){return MEMFS.createNode(null,"/",16895,0)},createNode:function(e,t,r,n){if(FS.isBlkdev(r)||FS.isFIFO(r))throw new FS.ErrnoError(63);MEMFS.ops_table||(MEMFS.ops_table={dir:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,lookup:MEMFS.node_ops.lookup,mknod:MEMFS.node_ops.mknod,rename:MEMFS.node_ops.rename,unlink:MEMFS.node_ops.unlink,rmdir:MEMFS.node_ops.rmdir,readdir:MEMFS.node_ops.readdir,symlink:MEMFS.node_ops.symlink},stream:{llseek:MEMFS.stream_ops.llseek}},file:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:{llseek:MEMFS.stream_ops.llseek,read:MEMFS.stream_ops.read,write:MEMFS.stream_ops.write,allocate:MEMFS.stream_ops.allocate,mmap:MEMFS.stream_ops.mmap,msync:MEMFS.stream_ops.msync}},link:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr,readlink:MEMFS.node_ops.readlink},stream:{}},chrdev:{node:{getattr:MEMFS.node_ops.getattr,setattr:MEMFS.node_ops.setattr},stream:FS.chrdev_stream_ops}});var o=FS.createNode(e,t,r,n);return FS.isDir(o.mode)?(o.node_ops=MEMFS.ops_table.dir.node,o.stream_ops=MEMFS.ops_table.dir.stream,o.contents={}):FS.isFile(o.mode)?(o.node_ops=MEMFS.ops_table.file.node,o.stream_ops=MEMFS.ops_table.file.stream,o.usedBytes=0,o.contents=null):FS.isLink(o.mode)?(o.node_ops=MEMFS.ops_table.link.node,o.stream_ops=MEMFS.ops_table.link.stream):FS.isChrdev(o.mode)&&(o.node_ops=MEMFS.ops_table.chrdev.node,o.stream_ops=MEMFS.ops_table.chrdev.stream),o.timestamp=Date.now(),e&&(e.contents[t]=o,e.timestamp=o.timestamp),o},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){var r=e.contents?e.contents.length:0;if(!(r>=t)){t=Math.max(t,r*(r<1048576?2:1.125)>>>0),0!=r&&(t=Math.max(t,256));var n=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(n.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(e.usedBytes!=t){if(0==t)e.contents=null,e.usedBytes=0;else{var r=e.contents;e.contents=new Uint8Array(t),r&&e.contents.set(r.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}}},node_ops:{getattr:function(e){var t={};return t.dev=FS.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,FS.isDir(e.mode)?t.size=4096:FS.isFile(e.mode)?t.size=e.usedBytes:FS.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&MEMFS.resizeFileStorage(e,t.size)},lookup:function(e,t){throw FS.genericErrors[44]},mknod:function(e,t,r,n){return MEMFS.createNode(e,t,r,n)},rename:function(e,t,r){if(FS.isDir(e.mode)){var n;try{n=FS.lookupNode(t,r)}catch(o){}if(n)for(var i in n.contents)throw new FS.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=r,t.contents[r]=e,t.timestamp=e.parent.timestamp,e.parent=t},unlink:function(e,t){delete e.contents[t],e.timestamp=Date.now()},rmdir:function(e,t){var r=FS.lookupNode(e,t);for(var n in r.contents)throw new FS.ErrnoError(55);delete e.contents[t],e.timestamp=Date.now()},readdir:function(e){var t=[".",".."];for(var r in e.contents)e.contents.hasOwnProperty(r)&&t.push(r);return t},symlink:function(e,t,r){var n=MEMFS.createNode(e,t,41471,0);return n.link=r,n},readlink:function(e){if(!FS.isLink(e.mode))throw new FS.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,r,n,o){var i=e.node.contents;if(o>=e.node.usedBytes)return 0;var a=Math.min(e.node.usedBytes-o,n);if(a>8&&i.subarray)t.set(i.subarray(o,o+a),r);else for(var s=0;s<a;s++)t[r+s]=i[o+s];return a},write:function(e,t,r,n,o,i){if(!n)return 0;var a=e.node;if(a.timestamp=Date.now(),t.subarray&&(!a.contents||a.contents.subarray)){if(i)return a.contents=t.subarray(r,r+n),a.usedBytes=n,n;if(0===a.usedBytes&&0===o)return a.contents=t.slice(r,r+n),a.usedBytes=n,n;if(o+n<=a.usedBytes)return a.contents.set(t.subarray(r,r+n),o),n}if(MEMFS.expandFileStorage(a,o+n),a.contents.subarray&&t.subarray)a.contents.set(t.subarray(r,r+n),o);else for(var s=0;s<n;s++)a.contents[o+s]=t[r+s];return a.usedBytes=Math.max(a.usedBytes,o+n),n},llseek:function(e,t,r){var n=t;if(1===r?n+=e.position:2===r&&FS.isFile(e.node.mode)&&(n+=e.node.usedBytes),n<0)throw new FS.ErrnoError(28);return n},allocate:function(e,t,r){MEMFS.expandFileStorage(e.node,t+r),e.node.usedBytes=Math.max(e.node.usedBytes,t+r)},mmap:function(e,t,r,n,o,i){if(0!==t)throw new FS.ErrnoError(28);if(!FS.isFile(e.node.mode))throw new FS.ErrnoError(43);var a,s,u=e.node.contents;if(2&i||u.buffer!==buffer){if((n>0||n+r<u.length)&&(u=u.subarray?u.subarray(n,n+r):Array.prototype.slice.call(u,n,n+r)),s=!0,!(a=mmapAlloc(r)))throw new FS.ErrnoError(48);HEAP8.set(u,a)}else s=!1,a=u.byteOffset;return{ptr:a,allocated:s}},msync:function(e,t,r,n,o){if(!FS.isFile(e.node.mode))throw new FS.ErrnoError(43);return 2&o||MEMFS.stream_ops.write(e,t,0,n,r,!1),0}}};function asyncLoad(e,t,r,n){var o=n?"":getUniqueRunDependency("al "+e);readAsync(e,function(r){assert(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),o&&removeRunDependency(o)},function(t){if(r)r();else throw'Loading data file "'+e+'" failed.'}),o&&addRunDependency(o)}var FS={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(e,t){if(e=PATH_FS.resolve(FS.cwd(),e),t=t||{},!e)return{path:"",node:null};var r={follow_mount:!0,recurse_count:0};for(var n in r)void 0===t[n]&&(t[n]=r[n]);if(t.recurse_count>8)throw new FS.ErrnoError(32);for(var o=PATH.normalizeArray(e.split("/").filter(function(e){return!!e}),!1),i=FS.root,a="/",s=0;s<o.length;s++){var u=s===o.length-1;if(u&&t.parent)break;if(i=FS.lookupNode(i,o[s]),a=PATH.join2(a,o[s]),FS.isMountpoint(i)&&(!u||u&&t.follow_mount)&&(i=i.mounted.root),!u||t.follow)for(var l=0;FS.isLink(i.mode);){var c=FS.readlink(a);if(a=PATH_FS.resolve(PATH.dirname(a),c),i=FS.lookupPath(a,{recurse_count:t.recurse_count}).node,l++>40)throw new FS.ErrnoError(32)}}return{path:a,node:i}},getPath:function(e){for(var t;;){if(FS.isRoot(e)){var r=e.mount.mountpoint;if(!t)return r;return"/"!==r[r.length-1]?r+"/"+t:r+t}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var r=0,n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)|0;return(e+r>>>0)%FS.nameTable.length},hashAddNode:function(e){var t=FS.hashName(e.parent.id,e.name);e.name_next=FS.nameTable[t],FS.nameTable[t]=e},hashRemoveNode:function(e){var t=FS.hashName(e.parent.id,e.name);if(FS.nameTable[t]===e)FS.nameTable[t]=e.name_next;else for(var r=FS.nameTable[t];r;){if(r.name_next===e){r.name_next=e.name_next;break}r=r.name_next}},lookupNode:function(e,t){var r=FS.mayLookup(e);if(r)throw new FS.ErrnoError(r,e);for(var n=FS.hashName(e.id,t),o=FS.nameTable[n];o;o=o.name_next){var i=o.name;if(o.parent.id===e.id&&i===t)return o}return FS.lookup(e,t)},createNode:function(e,t,r,n){var o=new FS.FSNode(e,t,r,n);return FS.hashAddNode(o),o},destroyNode:function(e){FS.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return(61440&e)==32768},isDir:function(e){return(61440&e)==16384},isLink:function(e){return(61440&e)==40960},isChrdev:function(e){return(61440&e)==8192},isBlkdev:function(e){return(61440&e)==24576},isFIFO:function(e){return(61440&e)==4096},isSocket:function(e){return(49152&e)==49152},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(e){var t=FS.flagModes[e];if(void 0===t)throw Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return FS.ignorePermissions?0:t.includes("r")&&!(292&e.mode)||t.includes("w")&&!(146&e.mode)||t.includes("x")&&!(73&e.mode)?2:0},mayLookup:function(e){var t=FS.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:function(e,t){try{return FS.lookupNode(e,t),20}catch(r){}return FS.nodePermissions(e,"wx")},mayDelete:function(e,t,r){try{o=FS.lookupNode(e,t)}catch(n){return n.errno}var o,i=FS.nodePermissions(e,"wx");if(i)return i;if(r){if(!FS.isDir(o.mode))return 54;if(FS.isRoot(o)||FS.getPath(o)===FS.cwd())return 10}else if(FS.isDir(o.mode))return 31;return 0},mayOpen:function(e,t){return e?FS.isLink(e.mode)?32:FS.isDir(e.mode)&&("r"!==FS.flagsToPermissionString(t)||512&t)?31:FS.nodePermissions(e,FS.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(e,t){e=e||0,t=t||FS.MAX_OPEN_FDS;for(var r=e;r<=t;r++)if(!FS.streams[r])return r;throw new FS.ErrnoError(33)},getStream:function(e){return FS.streams[e]},createStream:function(e,t,r){FS.FSStream||(FS.FSStream=function(){},FS.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return(2097155&this.flags)!=1}},isWrite:{get:function(){return(2097155&this.flags)!=0}},isAppend:{get:function(){return 1024&this.flags}}});var n=new FS.FSStream;for(var o in e)n[o]=e[o];e=n;var i=FS.nextfd(t,r);return e.fd=i,FS.streams[i]=e,e},closeStream:function(e){FS.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=FS.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new FS.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){FS.devices[e]={stream_ops:t}},getDevice:function(e){return FS.devices[e]},getMounts:function(e){for(var t=[],r=[e];r.length;){var n=r.pop();t.push(n),r.push.apply(r,n.mounts)}return t},syncfs:function(e,t){"function"==typeof e&&(t=e,e=!1),FS.syncFSRequests++,FS.syncFSRequests>1&&err("warning: "+FS.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var r=FS.getMounts(FS.root.mount),n=0;function o(e){return FS.syncFSRequests--,t(e)}function i(e){if(e)return i.errored?void 0:(i.errored=!0,o(e));++n>=r.length&&o(null)}r.forEach(function(t){if(!t.type.syncfs)return i(null);t.type.syncfs(t,e,i)})},mount:function(e,t,r){var n,o="/"===r,i=!r;if(o&&FS.root)throw new FS.ErrnoError(10);if(!o&&!i){var a=FS.lookupPath(r,{follow_mount:!1});if(r=a.path,n=a.node,FS.isMountpoint(n))throw new FS.ErrnoError(10);if(!FS.isDir(n.mode))throw new FS.ErrnoError(54)}var s={type:e,opts:t,mountpoint:r,mounts:[]},u=e.mount(s);return u.mount=s,s.root=u,o?FS.root=u:n&&(n.mounted=s,n.mount&&n.mount.mounts.push(s)),u},unmount:function(e){var t=FS.lookupPath(e,{follow_mount:!1});if(!FS.isMountpoint(t.node))throw new FS.ErrnoError(28);var r=t.node,n=r.mounted,o=FS.getMounts(n);Object.keys(FS.nameTable).forEach(function(e){for(var t=FS.nameTable[e];t;){var r=t.name_next;o.includes(t.mount)&&FS.destroyNode(t),t=r}}),r.mounted=null;var i=r.mount.mounts.indexOf(n);r.mount.mounts.splice(i,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,r){var n=FS.lookupPath(e,{parent:!0}).node,o=PATH.basename(e);if(!o||"."===o||".."===o)throw new FS.ErrnoError(28);var i=FS.mayCreate(n,o);if(i)throw new FS.ErrnoError(i);if(!n.node_ops.mknod)throw new FS.ErrnoError(63);return n.node_ops.mknod(n,o,t,r)},create:function(e,t){return t=void 0!==t?t:438,t&=4095,t|=32768,FS.mknod(e,t,0)},mkdir:function(e,t){return t=void 0!==t?t:511,t&=1023,t|=16384,FS.mknod(e,t,0)},mkdirTree:function(e,t){for(var r=e.split("/"),n="",o=0;o<r.length;++o)if(r[o]){n+="/"+r[o];try{FS.mkdir(n,t)}catch(i){if(20!=i.errno)throw i}}},mkdev:function(e,t,r){return void 0===r&&(r=t,t=438),t|=8192,FS.mknod(e,t,r)},symlink:function(e,t){if(!PATH_FS.resolve(e))throw new FS.ErrnoError(44);var r=FS.lookupPath(t,{parent:!0}).node;if(!r)throw new FS.ErrnoError(44);var n=PATH.basename(t),o=FS.mayCreate(r,n);if(o)throw new FS.ErrnoError(o);if(!r.node_ops.symlink)throw new FS.ErrnoError(63);return r.node_ops.symlink(r,n,e)},rename:function(e,t){var r,n,o,i,a=PATH.dirname(e),s=PATH.dirname(t),u=PATH.basename(e),l=PATH.basename(t);if(n=(r=FS.lookupPath(e,{parent:!0})).node,o=(r=FS.lookupPath(t,{parent:!0})).node,!n||!o)throw new FS.ErrnoError(44);if(n.mount!==o.mount)throw new FS.ErrnoError(75);var c=FS.lookupNode(n,u),m=PATH_FS.relative(e,s);if("."!==m.charAt(0))throw new FS.ErrnoError(28);if("."!==(m=PATH_FS.relative(t,a)).charAt(0))throw new FS.ErrnoError(55);try{i=FS.lookupNode(o,l)}catch(d){}if(c!==i){var f=FS.isDir(c.mode),p=FS.mayDelete(n,u,f);if(p||(p=i?FS.mayDelete(o,l,f):FS.mayCreate(o,l)))throw new FS.ErrnoError(p);if(!n.node_ops.rename)throw new FS.ErrnoError(63);if(FS.isMountpoint(c)||i&&FS.isMountpoint(i))throw new FS.ErrnoError(10);if(o!==n&&(p=FS.nodePermissions(n,"w")))throw new FS.ErrnoError(p);FS.hashRemoveNode(c);try{n.node_ops.rename(c,o,l)}catch(h){throw h}finally{FS.hashAddNode(c)}}},rmdir:function(e){var t=FS.lookupPath(e,{parent:!0}).node,r=PATH.basename(e),n=FS.lookupNode(t,r),o=FS.mayDelete(t,r,!0);if(o)throw new FS.ErrnoError(o);if(!t.node_ops.rmdir)throw new FS.ErrnoError(63);if(FS.isMountpoint(n))throw new FS.ErrnoError(10);t.node_ops.rmdir(t,r),FS.destroyNode(n)},readdir:function(e){var t=FS.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new FS.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=FS.lookupPath(e,{parent:!0}).node;if(!t)throw new FS.ErrnoError(44);var r=PATH.basename(e),n=FS.lookupNode(t,r),o=FS.mayDelete(t,r,!1);if(o)throw new FS.ErrnoError(o);if(!t.node_ops.unlink)throw new FS.ErrnoError(63);if(FS.isMountpoint(n))throw new FS.ErrnoError(10);t.node_ops.unlink(t,r),FS.destroyNode(n)},readlink:function(e){var t=FS.lookupPath(e).node;if(!t)throw new FS.ErrnoError(44);if(!t.node_ops.readlink)throw new FS.ErrnoError(28);return PATH_FS.resolve(FS.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var r=FS.lookupPath(e,{follow:!t}).node;if(!r)throw new FS.ErrnoError(44);if(!r.node_ops.getattr)throw new FS.ErrnoError(63);return r.node_ops.getattr(r)},lstat:function(e){return FS.stat(e,!0)},chmod:function(e,t,r){var n;if(!(n="string"==typeof e?FS.lookupPath(e,{follow:!r}).node:e).node_ops.setattr)throw new FS.ErrnoError(63);n.node_ops.setattr(n,{mode:4095&t|-4096&n.mode,timestamp:Date.now()})},lchmod:function(e,t){FS.chmod(e,t,!0)},fchmod:function(e,t){var r=FS.getStream(e);if(!r)throw new FS.ErrnoError(8);FS.chmod(r.node,t)},chown:function(e,t,r,n){var o;if(!(o="string"==typeof e?FS.lookupPath(e,{follow:!n}).node:e).node_ops.setattr)throw new FS.ErrnoError(63);o.node_ops.setattr(o,{timestamp:Date.now()})},lchown:function(e,t,r){FS.chown(e,t,r,!0)},fchown:function(e,t,r){var n=FS.getStream(e);if(!n)throw new FS.ErrnoError(8);FS.chown(n.node,t,r)},truncate:function(e,t){if(t<0)throw new FS.ErrnoError(28);if("string"==typeof e){var r;r=FS.lookupPath(e,{follow:!0}).node}else r=e;if(!r.node_ops.setattr)throw new FS.ErrnoError(63);if(FS.isDir(r.mode))throw new FS.ErrnoError(31);if(!FS.isFile(r.mode))throw new FS.ErrnoError(28);var n=FS.nodePermissions(r,"w");if(n)throw new FS.ErrnoError(n);r.node_ops.setattr(r,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var r=FS.getStream(e);if(!r)throw new FS.ErrnoError(8);if((2097155&r.flags)==0)throw new FS.ErrnoError(28);FS.truncate(r.node,t)},utime:function(e,t,r){var n=FS.lookupPath(e,{follow:!0}).node;n.node_ops.setattr(n,{timestamp:Math.max(t,r)})},open:function(e,t,r,n,o){if(""===e)throw new FS.ErrnoError(44);if(t="string"==typeof t?FS.modeStringToFlags(t):t,r=void 0===r?438:r,r=64&t?4095&r|32768:0,"object"==typeof e)i=e;else{e=PATH.normalize(e);try{var i;i=FS.lookupPath(e,{follow:!(131072&t)}).node}catch(a){}}var s=!1;if(64&t){if(i){if(128&t)throw new FS.ErrnoError(20)}else i=FS.mknod(e,r,0),s=!0}if(!i)throw new FS.ErrnoError(44);if(FS.isChrdev(i.mode)&&(t&=-513),65536&t&&!FS.isDir(i.mode))throw new FS.ErrnoError(54);if(!s){var u=FS.mayOpen(i,t);if(u)throw new FS.ErrnoError(u)}512&t&&FS.truncate(i,0),t&=-131713;var l=FS.createStream({node:i,path:FS.getPath(i),id:i.id,flags:t,mode:i.mode,seekable:!0,position:0,stream_ops:i.stream_ops,node_ops:i.node_ops,ungotten:[],error:!1},n,o);return l.stream_ops.open&&l.stream_ops.open(l),!Module.logReadFiles||1&t||(FS.readFiles||(FS.readFiles={}),e in FS.readFiles||(FS.readFiles[e]=1)),l},close:function(e){if(FS.isClosed(e))throw new FS.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(t){throw t}finally{FS.closeStream(e.fd)}e.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,r){if(FS.isClosed(e))throw new FS.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new FS.ErrnoError(70);if(0!=r&&1!=r&&2!=r)throw new FS.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,r),e.ungotten=[],e.position},read:function(e,t,r,n,o){if(n<0||o<0)throw new FS.ErrnoError(28);if(FS.isClosed(e)||(2097155&e.flags)==1)throw new FS.ErrnoError(8);if(FS.isDir(e.node.mode))throw new FS.ErrnoError(31);if(!e.stream_ops.read)throw new FS.ErrnoError(28);var i=void 0!==o;if(i){if(!e.seekable)throw new FS.ErrnoError(70)}else o=e.position;var a=e.stream_ops.read(e,t,r,n,o);return i||(e.position+=a),a},write:function(e,t,r,n,o,i){if(n<0||o<0)throw new FS.ErrnoError(28);if(FS.isClosed(e)||(2097155&e.flags)==0)throw new FS.ErrnoError(8);if(FS.isDir(e.node.mode))throw new FS.ErrnoError(31);if(!e.stream_ops.write)throw new FS.ErrnoError(28);e.seekable&&1024&e.flags&&FS.llseek(e,0,2);var a=void 0!==o;if(a){if(!e.seekable)throw new FS.ErrnoError(70)}else o=e.position;var s=e.stream_ops.write(e,t,r,n,o,i);return a||(e.position+=s),s},allocate:function(e,t,r){if(FS.isClosed(e))throw new FS.ErrnoError(8);if(t<0||r<=0)throw new FS.ErrnoError(28);if((2097155&e.flags)==0)throw new FS.ErrnoError(8);if(!FS.isFile(e.node.mode)&&!FS.isDir(e.node.mode))throw new FS.ErrnoError(43);if(!e.stream_ops.allocate)throw new FS.ErrnoError(138);e.stream_ops.allocate(e,t,r)},mmap:function(e,t,r,n,o,i){if((2&o)!=0&&(2&i)==0&&(2097155&e.flags)!=2||(2097155&e.flags)==1)throw new FS.ErrnoError(2);if(!e.stream_ops.mmap)throw new FS.ErrnoError(43);return e.stream_ops.mmap(e,t,r,n,o,i)},msync:function(e,t,r,n,o){return e&&e.stream_ops.msync?e.stream_ops.msync(e,t,r,n,o):0},munmap:function(e){return 0},ioctl:function(e,t,r){if(!e.stream_ops.ioctl)throw new FS.ErrnoError(59);return e.stream_ops.ioctl(e,t,r)},readFile:function(e,t){if((t=t||{}).flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw Error('Invalid encoding type "'+t.encoding+'"');var r,n=FS.open(e,t.flags),o=FS.stat(e).size,i=new Uint8Array(o);return FS.read(n,i,0,o,0),"utf8"===t.encoding?r=UTF8ArrayToString(i,0):"binary"===t.encoding&&(r=i),FS.close(n),r},writeFile:function(e,t,r){(r=r||{}).flags=r.flags||577;var n=FS.open(e,r.flags,r.mode);if("string"==typeof t){var o=new Uint8Array(lengthBytesUTF8(t)+1),i=stringToUTF8Array(t,o,0,o.length);FS.write(n,o,0,i,void 0,r.canOwn)}else if(ArrayBuffer.isView(t))FS.write(n,t,0,t.byteLength,void 0,r.canOwn);else throw Error("Unsupported data type");FS.close(n)},cwd:function(){return FS.currentPath},chdir:function(e){var t=FS.lookupPath(e,{follow:!0});if(null===t.node)throw new FS.ErrnoError(44);if(!FS.isDir(t.node.mode))throw new FS.ErrnoError(54);var r=FS.nodePermissions(t.node,"x");if(r)throw new FS.ErrnoError(r);FS.currentPath=t.path},createDefaultDirectories:function(){FS.mkdir("/tmp"),FS.mkdir("/home"),FS.mkdir("/home/web_user")},createDefaultDevices:function(){FS.mkdir("/dev"),FS.registerDevice(FS.makedev(1,3),{read:function(){return 0},write:function(e,t,r,n,o){return n}}),FS.mkdev("/dev/null",FS.makedev(1,3)),TTY.register(FS.makedev(5,0),TTY.default_tty_ops),TTY.register(FS.makedev(6,0),TTY.default_tty1_ops),FS.mkdev("/dev/tty",FS.makedev(5,0)),FS.mkdev("/dev/tty1",FS.makedev(6,0));var e=getRandomDevice();FS.createDevice("/dev","random",e),FS.createDevice("/dev","urandom",e),FS.mkdir("/dev/shm"),FS.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){FS.mkdir("/proc");var e=FS.mkdir("/proc/self");FS.mkdir("/proc/self/fd"),FS.mount({mount:function(){var t=FS.createNode(e,"fd",16895,73);return t.node_ops={lookup:function(e,t){var r=FS.getStream(+t);if(!r)throw new FS.ErrnoError(8);var n={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return r.path}}};return n.parent=n,n}},t}},{},"/proc/self/fd")},createStandardStreams:function(){Module.stdin?FS.createDevice("/dev","stdin",Module.stdin):FS.symlink("/dev/tty","/dev/stdin"),Module.stdout?FS.createDevice("/dev","stdout",null,Module.stdout):FS.symlink("/dev/tty","/dev/stdout"),Module.stderr?FS.createDevice("/dev","stderr",null,Module.stderr):FS.symlink("/dev/tty1","/dev/stderr"),FS.open("/dev/stdin",0),FS.open("/dev/stdout",1),FS.open("/dev/stderr",1)},ensureErrnoError:function(){FS.ErrnoError||(FS.ErrnoError=function e(t,r){this.node=r,this.setErrno=function(e){this.errno=e},this.setErrno(t),this.message="FS error"},FS.ErrnoError.prototype=Error(),FS.ErrnoError.prototype.constructor=FS.ErrnoError,[44].forEach(function(e){FS.genericErrors[e]=new FS.ErrnoError(e),FS.genericErrors[e].stack="<generic error, no stack>"}))},staticInit:function(){FS.ensureErrnoError(),FS.nameTable=Array(4096),FS.mount(MEMFS,{},"/"),FS.createDefaultDirectories(),FS.createDefaultDevices(),FS.createSpecialDirectories(),FS.filesystems={MEMFS:MEMFS}},init:function(e,t,r){FS.init.initialized=!0,FS.ensureErrnoError(),Module.stdin=e||Module.stdin,Module.stdout=t||Module.stdout,Module.stderr=r||Module.stderr,FS.createStandardStreams()},quit:function(){FS.init.initialized=!1;for(var e=0;e<FS.streams.length;e++){var t=FS.streams[e];t&&FS.close(t)}},getMode:function(e,t){var r=0;return e&&(r|=365),t&&(r|=146),r},findObject:function(e,t){var r=FS.analyzePath(e,t);return r.exists?r.object:null},analyzePath:function(e,t){try{var r=FS.lookupPath(e,{follow:!t});e=r.path}catch(n){}var o={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var r=FS.lookupPath(e,{parent:!0});o.parentExists=!0,o.parentPath=r.path,o.parentObject=r.node,o.name=PATH.basename(e),r=FS.lookupPath(e,{follow:!t}),o.exists=!0,o.path=r.path,o.object=r.node,o.name=r.node.name,o.isRoot="/"===r.path}catch(i){o.error=i.errno}return o},createPath:function(e,t,r,n){e="string"==typeof e?e:FS.getPath(e);for(var o=t.split("/").reverse();o.length;){var i=o.pop();if(i){var a=PATH.join2(e,i);try{FS.mkdir(a)}catch(s){}e=a}}return a},createFile:function(e,t,r,n,o){var i=PATH.join2("string"==typeof e?e:FS.getPath(e),t),a=FS.getMode(n,o);return FS.create(i,a)},createDataFile:function(e,t,r,n,o,i){var a=t?PATH.join2("string"==typeof e?e:FS.getPath(e),t):e,s=FS.getMode(n,o),u=FS.create(a,s);if(r){if("string"==typeof r){for(var l=Array(r.length),c=0,m=r.length;c<m;++c)l[c]=r.charCodeAt(c);r=l}FS.chmod(u,146|s);var d=FS.open(u,577);FS.write(d,r,0,r.length,0,i),FS.close(d),FS.chmod(u,s)}return u},createDevice:function(e,t,r,n){var o=PATH.join2("string"==typeof e?e:FS.getPath(e),t),i=FS.getMode(!!r,!!n);FS.createDevice.major||(FS.createDevice.major=64);var a=FS.makedev(FS.createDevice.major++,0);return FS.registerDevice(a,{open:function(e){e.seekable=!1},close:function(e){n&&n.buffer&&n.buffer.length&&n(10)},read:function(e,t,n,o,i){for(var a,s=0,u=0;u<o;u++){try{a=r()}catch(l){throw new FS.ErrnoError(29)}if(void 0===a&&0===s)throw new FS.ErrnoError(6);if(null==a)break;s++,t[n+u]=a}return s&&(e.node.timestamp=Date.now()),s},write:function(e,t,r,o,i){for(var a=0;a<o;a++)try{n(t[r+a])}catch(s){throw new FS.ErrnoError(29)}return o&&(e.node.timestamp=Date.now()),a}}),FS.mkdev(o,i,a)},forceLoadFile:function(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(read_)try{e.contents=intArrayFromString(read_(e.url),!0),e.usedBytes=e.contents.length}catch(t){throw new FS.ErrnoError(29)}else throw Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:function(e,t,r,n,o){function i(){this.lengthKnown=!1,this.chunks=[]}if(i.prototype.get=function e(t){if(!(t>this.length-1)&&!(t<0)){var r=t%this.chunkSize,n=t/this.chunkSize|0;return this.getter(n)[r]}},i.prototype.setDataGetter=function e(t){this.getter=t},i.prototype.cacheLength=function e(){var t,n=new XMLHttpRequest;if(n.open("HEAD",r,!1),n.send(null),!(n.status>=200&&n.status<300||304===n.status))throw Error("Couldn't load "+r+". Status: "+n.status);var o=Number(n.getResponseHeader("Content-length")),i=(t=n.getResponseHeader("Accept-Ranges"))&&"bytes"===t,a=(t=n.getResponseHeader("Content-Encoding"))&&"gzip"===t,s=1048576;i||(s=o);var u=function(e,t){if(e>t)throw Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>o-1)throw Error("only "+o+" bytes available! programmer error!");var n=new XMLHttpRequest;if(n.open("GET",r,!1),o!==s&&n.setRequestHeader("Range","bytes="+e+"-"+t),"undefined"!=typeof Uint8Array&&(n.responseType="arraybuffer"),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.send(null),!(n.status>=200&&n.status<300||304===n.status))throw Error("Couldn't load "+r+". Status: "+n.status);return void 0!==n.response?new Uint8Array(n.response||[]):intArrayFromString(n.responseText||"",!0)},l=this;l.setDataGetter(function(e){var t=e*s,r=(e+1)*s-1;if(r=Math.min(r,o-1),void 0===l.chunks[e]&&(l.chunks[e]=u(t,r)),void 0===l.chunks[e])throw Error("doXHR failed!");return l.chunks[e]}),(a||!o)&&(s=o=1,s=o=this.getter(0).length,out("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=o,this._chunkSize=s,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!ENVIRONMENT_IS_WORKER)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var a=new i;Object.defineProperties(a,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var s={isDevice:!1,contents:a}}else var s={isDevice:!1,url:r};var u=FS.createFile(e,t,s,n,o);s.contents?u.contents=s.contents:s.url&&(u.contents=null,u.url=s.url),Object.defineProperties(u,{usedBytes:{get:function(){return this.contents.length}}});var l={};return Object.keys(u.stream_ops).forEach(function(e){var t=u.stream_ops[e];l[e]=function e(){return FS.forceLoadFile(u),t.apply(null,arguments)}}),l.read=function e(t,r,n,o,i){FS.forceLoadFile(u);var a=t.node.contents;if(i>=a.length)return 0;var s=Math.min(a.length-i,o);if(a.slice)for(var l=0;l<s;l++)r[n+l]=a[i+l];else for(var l=0;l<s;l++)r[n+l]=a.get(i+l);return s},u.stream_ops=l,u},createPreloadedFile:function(e,t,r,n,o,i,a,s,u,l){Browser.init();var c=t?PATH_FS.resolve(PATH.join2(e,t)):e,m=getUniqueRunDependency("cp "+c);function d(r){function d(r){l&&l(),s||FS.createDataFile(e,t,r,n,o,u),i&&i(),removeRunDependency(m)}var f=!1;Module.preloadPlugins.forEach(function(e){!f&&e.canHandle(c)&&(e.handle(r,c,d,function(){a&&a(),removeRunDependency(m)}),f=!0)}),f||d(r)}addRunDependency(m),"string"==typeof r?asyncLoad(r,function(e){d(e)},a):d(r)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(e,t,r){t=t||function(){},r=r||function(){};var n=FS.indexedDB();try{var o=n.open(FS.DB_NAME(),FS.DB_VERSION)}catch(i){return r(i)}o.onupgradeneeded=function e(){out("creating db"),o.result.createObjectStore(FS.DB_STORE_NAME)},o.onsuccess=function n(){var i=o.result.transaction([FS.DB_STORE_NAME],"readwrite"),a=i.objectStore(FS.DB_STORE_NAME),s=0,u=0,l=e.length;function c(){0==u?t():r()}e.forEach(function(e){var t=a.put(FS.analyzePath(e).object.contents,e);t.onsuccess=function e(){++s+u==l&&c()},t.onerror=function e(){s+ ++u==l&&c()}}),i.onerror=r},o.onerror=r},loadFilesFromDB:function(e,t,r){t=t||function(){},r=r||function(){};var n=FS.indexedDB();try{var o=n.open(FS.DB_NAME(),FS.DB_VERSION)}catch(i){return r(i)}o.onupgradeneeded=r,o.onsuccess=function n(){var i=o.result;try{var a=i.transaction([FS.DB_STORE_NAME],"readonly")}catch(s){r(s);return}var u=a.objectStore(FS.DB_STORE_NAME),l=0,c=0,m=e.length;function d(){0==c?t():r()}e.forEach(function(e){var t=u.get(e);t.onsuccess=function r(){FS.analyzePath(e).exists&&FS.unlink(e),FS.createDataFile(PATH.dirname(e),PATH.basename(e),t.result,!0,!0,!0),++l+c==m&&d()},t.onerror=function e(){l+ ++c==m&&d()}}),a.onerror=r},o.onerror=r}},SYSCALLS={mappings:{},DEFAULT_POLLMASK:5,calculateAt:function(e,t,r){if("/"===t[0])return t;if(-100===e)n=FS.cwd();else{var n,o=FS.getStream(e);if(!o)throw new FS.ErrnoError(8);n=o.path}if(0==t.length){if(!r)throw new FS.ErrnoError(44);return n}return PATH.join2(n,t)},doStat:function(e,t,r){try{var n=e(t)}catch(o){if(o&&o.node&&PATH.normalize(t)!==PATH.normalize(FS.getPath(o.node)))return -54;throw o}return HEAP32[r>>2]=n.dev,HEAP32[r+4>>2]=0,HEAP32[r+8>>2]=n.ino,HEAP32[r+12>>2]=n.mode,HEAP32[r+16>>2]=n.nlink,HEAP32[r+20>>2]=n.uid,HEAP32[r+24>>2]=n.gid,HEAP32[r+28>>2]=n.rdev,HEAP32[r+32>>2]=0,tempI64=[n.size>>>0,+Math.abs(tempDouble=n.size)>=1?tempDouble>0?(0|Math.min(+Math.floor(tempDouble/4294967296),4294967295))>>>0:~~+Math.ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0],HEAP32[r+40>>2]=tempI64[0],HEAP32[r+44>>2]=tempI64[1],HEAP32[r+48>>2]=4096,HEAP32[r+52>>2]=n.blocks,HEAP32[r+56>>2]=n.atime.getTime()/1e3|0,HEAP32[r+60>>2]=0,HEAP32[r+64>>2]=n.mtime.getTime()/1e3|0,HEAP32[r+68>>2]=0,HEAP32[r+72>>2]=n.ctime.getTime()/1e3|0,HEAP32[r+76>>2]=0,tempI64=[n.ino>>>0,+Math.abs(tempDouble=n.ino)>=1?tempDouble>0?(0|Math.min(+Math.floor(tempDouble/4294967296),4294967295))>>>0:~~+Math.ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0],HEAP32[r+80>>2]=tempI64[0],HEAP32[r+84>>2]=tempI64[1],0},doMsync:function(e,t,r,n,o){var i=HEAPU8.slice(e,e+r);FS.msync(t,i,o,r,n)},doMkdir:function(e,t){return"/"===(e=PATH.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),FS.mkdir(e,t,0),0},doMknod:function(e,t,r){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return -28}return FS.mknod(e,t,r),0},doReadlink:function(e,t,r){if(r<=0)return -28;var n=FS.readlink(e),o=Math.min(r,lengthBytesUTF8(n)),i=HEAP8[t+o];return stringToUTF8(n,t,r+1),HEAP8[t+o]=i,o},doAccess:function(e,t){if(-8&t)return -28;var r=FS.lookupPath(e,{follow:!0}).node;if(!r)return -44;var n="";return(4&t&&(n+="r"),2&t&&(n+="w"),1&t&&(n+="x"),n&&FS.nodePermissions(r,n))?-2:0},doDup:function(e,t,r){var n=FS.getStream(r);return n&&FS.close(n),FS.open(e,t,0,r,r).fd},doReadv:function(e,t,r,n){for(var o=0,i=0;i<r;i++){var a=HEAP32[t+8*i>>2],s=HEAP32[t+(8*i+4)>>2],u=FS.read(e,HEAP8,a,s,n);if(u<0)return -1;if(o+=u,u<s)break}return o},doWritev:function(e,t,r,n){for(var o=0,i=0;i<r;i++){var a=HEAP32[t+8*i>>2],s=HEAP32[t+(8*i+4)>>2],u=FS.write(e,HEAP8,a,s,n);if(u<0)return -1;o+=u}return o},varargs:void 0,get:function(){return SYSCALLS.varargs+=4,HEAP32[SYSCALLS.varargs-4>>2]},getStr:function(e){return UTF8ToString(e)},getStreamFromFD:function(e){var t=FS.getStream(e);if(!t)throw new FS.ErrnoError(8);return t},get64:function(e,t){return e}};function _environ_get(e,t){var r=0;return getEnvStrings().forEach(function(n,o){var i=t+r;HEAP32[e+4*o>>2]=i,writeAsciiToMemory(n,i),r+=n.length+1}),0}function _environ_sizes_get(e,t){var r=getEnvStrings();HEAP32[e>>2]=r.length;var n=0;return r.forEach(function(e){n+=e.length+1}),HEAP32[t>>2]=n,0}function _exit(e){exit(e)}function _fd_close(e){try{var t=SYSCALLS.getStreamFromFD(e);return FS.close(t),0}catch(r){if(void 0===FS||!(r instanceof FS.ErrnoError))throw r;return r.errno}}function _fd_read(e,t,r,n){try{var o=SYSCALLS.getStreamFromFD(e),i=SYSCALLS.doReadv(o,t,r);return HEAP32[n>>2]=i,0}catch(a){if(void 0===FS||!(a instanceof FS.ErrnoError))throw a;return a.errno}}function _fd_seek(e,t,r,n,o){try{var i=SYSCALLS.getStreamFromFD(e),a=4294967296*r+(t>>>0);if(a<=-9007199254740992||a>=9007199254740992)return -61;return FS.llseek(i,a,n),tempI64=[i.position>>>0,(tempDouble=i.position,+Math.abs(tempDouble)>=1?tempDouble>0?(0|Math.min(+Math.floor(tempDouble/4294967296),4294967295))>>>0:~~+Math.ceil((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],HEAP32[o>>2]=tempI64[0],HEAP32[o+4>>2]=tempI64[1],i.getdents&&0===a&&0===n&&(i.getdents=null),0}catch(s){if(void 0===FS||!(s instanceof FS.ErrnoError))throw s;return s.errno}}function _fd_write(e,t,r,n){try{var o=SYSCALLS.getStreamFromFD(e),i=SYSCALLS.doWritev(o,t,r);return HEAP32[n>>2]=i,0}catch(a){if(void 0===FS||!(a instanceof FS.ErrnoError))throw a;return a.errno}}function _emscripten_set_main_loop_timing(e,t){if(Browser.mainLoop.timingMode=e,Browser.mainLoop.timingValue=t,!Browser.mainLoop.func)return 1;if(Browser.mainLoop.running||(Browser.mainLoop.running=!0),0==e)Browser.mainLoop.scheduler=function e(){var r=0|Math.max(0,Browser.mainLoop.tickStartTime+t-_emscripten_get_now());setTimeout(Browser.mainLoop.runner,r)},Browser.mainLoop.method="timeout";else if(1==e)Browser.mainLoop.scheduler=function e(){Browser.requestAnimationFrame(Browser.mainLoop.runner)},Browser.mainLoop.method="rAF";else if(2==e){if("undefined"==typeof setImmediate){var r=[],n="setimmediate";addEventListener("message",function(e){(e.data===n||e.data.target===n)&&(e.stopPropagation(),r.shift()())},!0),setImmediate=function e(t){r.push(t),ENVIRONMENT_IS_WORKER?(void 0===Module.setImmediates&&(Module.setImmediates=[]),Module.setImmediates.push(t),postMessage({target:n})):postMessage(n,"*")}}Browser.mainLoop.scheduler=function e(){setImmediate(Browser.mainLoop.runner)},Browser.mainLoop.method="immediate"}return 0}function maybeExit(){if(!keepRuntimeAlive())try{_exit(EXITSTATUS)}catch(e){handleException(e)}}function setMainLoop(e,t,r,n,o){assert(!Browser.mainLoop.func,"emscripten_set_main_loop: there can only be one main loop function at once: call emscripten_cancel_main_loop to cancel the previous one before setting a new one with different parameters."),Browser.mainLoop.func=e,Browser.mainLoop.arg=n;var i=Browser.mainLoop.currentlyRunningMainloop;function a(){return!(i<Browser.mainLoop.currentlyRunningMainloop)||(maybeExit(),!1)}if(Browser.mainLoop.running=!1,Browser.mainLoop.runner=function t(){if(!ABORT){if(Browser.mainLoop.queue.length>0){var r=Date.now(),n=Browser.mainLoop.queue.shift();if(n.func(n.arg),Browser.mainLoop.remainingBlockers){var o=Browser.mainLoop.remainingBlockers,i=o%1==0?o-1:Math.floor(o);n.counted?Browser.mainLoop.remainingBlockers=i:(i+=.5,Browser.mainLoop.remainingBlockers=(8*o+i)/9)}if(out('main loop blocker "'+n.name+'" took '+(Date.now()-r)+" ms"),Browser.mainLoop.updateStatus(),!a())return;setTimeout(Browser.mainLoop.runner,0);return}if(a()){if(Browser.mainLoop.currentFrameNumber=Browser.mainLoop.currentFrameNumber+1|0,1==Browser.mainLoop.timingMode&&Browser.mainLoop.timingValue>1&&Browser.mainLoop.currentFrameNumber%Browser.mainLoop.timingValue!=0){Browser.mainLoop.scheduler();return}0==Browser.mainLoop.timingMode&&(Browser.mainLoop.tickStartTime=_emscripten_get_now()),GL.newRenderingFrameStarted(),Browser.mainLoop.runIter(e),a()&&("object"==typeof SDL&&SDL.audio&&SDL.audio.queueNewAudioData&&SDL.audio.queueNewAudioData(),Browser.mainLoop.scheduler())}}},o||(t&&t>0?_emscripten_set_main_loop_timing(0,1e3/t):_emscripten_set_main_loop_timing(1,1),Browser.mainLoop.scheduler()),r)throw"unwind"}function callUserCallback(e,t){if(!runtimeExited&&!ABORT){if(t){e();return}try{e()}catch(r){handleException(r)}}}function safeSetTimeout(e,t){return setTimeout(function(){callUserCallback(e)},t)}var Browser={mainLoop:{running:!1,scheduler:null,method:"",currentlyRunningMainloop:0,func:null,arg:0,timingMode:0,timingValue:0,currentFrameNumber:0,queue:[],pause:function(){Browser.mainLoop.scheduler=null,Browser.mainLoop.currentlyRunningMainloop++},resume:function(){Browser.mainLoop.currentlyRunningMainloop++;var e=Browser.mainLoop.timingMode,t=Browser.mainLoop.timingValue,r=Browser.mainLoop.func;Browser.mainLoop.func=null,setMainLoop(r,0,!1,Browser.mainLoop.arg,!0),_emscripten_set_main_loop_timing(e,t),Browser.mainLoop.scheduler()},updateStatus:function(){if(Module.setStatus){var e=Module.statusMessage||"Please wait...",t=Browser.mainLoop.remainingBlockers,r=Browser.mainLoop.expectedBlockers;t?t<r?Module.setStatus(e+" ("+(r-t)+"/"+r+")"):Module.setStatus(e):Module.setStatus("")}},runIter:function(e){if(!ABORT){if(!Module.preMainLoop||!1!==Module.preMainLoop())callUserCallback(e),Module.postMainLoop&&Module.postMainLoop()}}},isFullscreen:!1,pointerLock:!1,moduleContextCreatedCallbacks:[],workers:[],init:function(){if(Module.preloadPlugins||(Module.preloadPlugins=[]),!Browser.initted){Browser.initted=!0;try{new Blob,Browser.hasBlobConstructor=!0}catch(e){Browser.hasBlobConstructor=!1,out("warning: no blob constructor, cannot create blobs with mimetypes")}Browser.BlobBuilder="undefined"!=typeof MozBlobBuilder?MozBlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:Browser.hasBlobConstructor?null:out("warning: no BlobBuilder"),Browser.URLObject="undefined"!=typeof window?window.URL?window.URL:window.webkitURL:void 0,Module.noImageDecoding||void 0!==Browser.URLObject||(out("warning: Browser does not support creating object URLs. Built-in browser image decoding will not be available."),Module.noImageDecoding=!0);var t={};t.canHandle=function e(t){return!Module.noImageDecoding&&/\.(jpg|jpeg|png|bmp)$/i.test(t)},t.handle=function e(t,r,n,o){var i=null;if(Browser.hasBlobConstructor)try{(i=new Blob([t],{type:Browser.getMimetype(r)})).size!==t.length&&(i=new Blob([new Uint8Array(t).buffer],{type:Browser.getMimetype(r)}))}catch(a){warnOnce("Blob constructor present but fails: "+a+"; falling back to blob builder")}if(!i){var s=new Browser.BlobBuilder;s.append(new Uint8Array(t).buffer),i=s.getBlob()}var u=Browser.URLObject.createObjectURL(i),l=new Image;l.onload=()=>{assert(l.complete,"Image "+r+" could not be decoded");var e=document.createElement("canvas");e.width=l.width,e.height=l.height,e.getContext("2d").drawImage(l,0,0),Module.preloadedImages[r]=e,Browser.URLObject.revokeObjectURL(u),n&&n(t)},l.onerror=e=>{out("Image "+u+" could not be decoded"),o&&o()},l.src=u},Module.preloadPlugins.push(t);var r={};r.canHandle=function e(t){return!Module.noAudioDecoding&&t.substr(-4) in{".ogg":1,".wav":1,".mp3":1}},r.handle=function e(t,r,n,o){var i=!1;function a(e){!i&&(i=!0,Module.preloadedAudios[r]=e,n&&n(t))}function s(){!i&&(i=!0,Module.preloadedAudios[r]=new Audio,o&&o())}if(!Browser.hasBlobConstructor)return s();try{var u=new Blob([t],{type:Browser.getMimetype(r)})}catch(l){return s()}var c=Browser.URLObject.createObjectURL(u),m=new Audio;m.addEventListener("canplaythrough",function(){a(m)},!1),m.onerror=function e(n){i||(out("warning: browser could not fully decode audio "+r+", trying slower base64 approach"),m.src="data:audio/x-"+r.substr(-3)+";base64,"+function e(t){for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",o=0,i=0,a=0;a<t.length;a++)for(o=o<<8|t[a],i+=8;i>=6;){var s=o>>i-6&63;i-=6,n+=r[s]}return 2==i?(n+=r[(3&o)<<4],n+="=="):4==i&&(n+=r[(15&o)<<2],n+="="),n}(t),a(m))},m.src=c,safeSetTimeout(function(){a(m)},1e4)},Module.preloadPlugins.push(r);var n=Module.canvas;n&&(n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock||n.msRequestPointerLock||function(){},n.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock||document.msExitPointerLock||function(){},n.exitPointerLock=n.exitPointerLock.bind(document),document.addEventListener("pointerlockchange",o,!1),document.addEventListener("mozpointerlockchange",o,!1),document.addEventListener("webkitpointerlockchange",o,!1),document.addEventListener("mspointerlockchange",o,!1),Module.elementPointerLock&&n.addEventListener("click",function(e){!Browser.pointerLock&&Module.canvas.requestPointerLock&&(Module.canvas.requestPointerLock(),e.preventDefault())},!1))}function o(){Browser.pointerLock=document.pointerLockElement===Module.canvas||document.mozPointerLockElement===Module.canvas||document.webkitPointerLockElement===Module.canvas||document.msPointerLockElement===Module.canvas}},createContext:function(e,t,r,n){if(t&&Module.ctx&&e==Module.canvas)return Module.ctx;if(t){var o,i,a={antialias:!1,alpha:!1,majorVersion:1};if(n)for(var s in n)a[s]=n[s];void 0!==GL&&(i=GL.createContext(e,a))&&(o=GL.getContext(i).GLctx)}else o=e.getContext("2d");return o?(r&&(t||assert(void 0===GLctx,"cannot set in module if GLctx is used, but we are a non-GL context that would replace it"),Module.ctx=o,t&&GL.makeContextCurrent(i),Module.useWebGL=t,Browser.moduleContextCreatedCallbacks.forEach(function(e){e()}),Browser.init()),o):null},destroyContext:function(e,t,r){},fullscreenHandlersInstalled:!1,lockPointer:void 0,resizeCanvas:void 0,requestFullscreen:function(e,t){Browser.lockPointer=e,Browser.resizeCanvas=t,void 0===Browser.lockPointer&&(Browser.lockPointer=!0),void 0===Browser.resizeCanvas&&(Browser.resizeCanvas=!1);var r=Module.canvas;function n(){Browser.isFullscreen=!1;var e=r.parentNode;(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e?(r.exitFullscreen=Browser.exitFullscreen,Browser.lockPointer&&r.requestPointerLock(),Browser.isFullscreen=!0,Browser.resizeCanvas?Browser.setFullscreenCanvasSize():Browser.updateCanvasDimensions(r)):(e.parentNode.insertBefore(r,e),e.parentNode.removeChild(e),Browser.resizeCanvas?Browser.setWindowedCanvasSize():Browser.updateCanvasDimensions(r)),Module.onFullScreen&&Module.onFullScreen(Browser.isFullscreen),Module.onFullscreen&&Module.onFullscreen(Browser.isFullscreen)}Browser.fullscreenHandlersInstalled||(Browser.fullscreenHandlersInstalled=!0,document.addEventListener("fullscreenchange",n,!1),document.addEventListener("mozfullscreenchange",n,!1),document.addEventListener("webkitfullscreenchange",n,!1),document.addEventListener("MSFullscreenChange",n,!1));var o=document.createElement("div");r.parentNode.insertBefore(o,r),o.appendChild(r),o.requestFullscreen=o.requestFullscreen||o.mozRequestFullScreen||o.msRequestFullscreen||(o.webkitRequestFullscreen?function(){o.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}:null)||(o.webkitRequestFullScreen?function(){o.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:null),o.requestFullscreen()},exitFullscreen:function(){return!!Browser.isFullscreen&&((document.exitFullscreen||document.cancelFullScreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitCancelFullScreen||function(){}).apply(document,[]),!0)},nextRAF:0,fakeRequestAnimationFrame:function(e){var t=Date.now();if(0===Browser.nextRAF)Browser.nextRAF=t+1e3/60;else for(;t+2>=Browser.nextRAF;)Browser.nextRAF+=1e3/60;setTimeout(e,Math.max(Browser.nextRAF-t,0))},requestAnimationFrame:function(e){if("function"==typeof requestAnimationFrame){requestAnimationFrame(e);return}(0,Browser.fakeRequestAnimationFrame)(e)},safeSetTimeout:function(e){return safeSetTimeout(e)},safeRequestAnimationFrame:function(e){return Browser.requestAnimationFrame(function(){callUserCallback(e)})},getMimetype:function(e){return({jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",bmp:"image/bmp",ogg:"audio/ogg",wav:"audio/wav",mp3:"audio/mpeg"})[e.substr(e.lastIndexOf(".")+1)]},getUserMedia:function(e){window.getUserMedia||(window.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia),window.getUserMedia(e)},getMovementX:function(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0},getMovementY:function(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0},getMouseWheelDelta:function(e){var t=0;switch(e.type){case"DOMMouseScroll":t=e.detail/3;break;case"mousewheel":t=e.wheelDelta/120;break;case"wheel":switch(t=e.deltaY,e.deltaMode){case 0:t/=100;break;case 1:t/=3;break;case 2:t*=80;break;default:throw"unrecognized mouse wheel delta mode: "+e.deltaMode}break;default:throw"unrecognized mouse wheel event: "+e.type}return t},mouseX:0,mouseY:0,mouseMovementX:0,mouseMovementY:0,touches:{},lastTouches:{},calculateMouseEvent:function(e){if(Browser.pointerLock)"mousemove"!=e.type&&"mozMovementX"in e?Browser.mouseMovementX=Browser.mouseMovementY=0:(Browser.mouseMovementX=Browser.getMovementX(e),Browser.mouseMovementY=Browser.getMovementY(e)),"undefined"!=typeof SDL?(Browser.mouseX=SDL.mouseX+Browser.mouseMovementX,Browser.mouseY=SDL.mouseY+Browser.mouseMovementY):(Browser.mouseX+=Browser.mouseMovementX,Browser.mouseY+=Browser.mouseMovementY);else{var t=Module.canvas.getBoundingClientRect(),r=Module.canvas.width,n=Module.canvas.height,o=void 0!==window.scrollX?window.scrollX:window.pageXOffset,i=void 0!==window.scrollY?window.scrollY:window.pageYOffset;if("touchstart"===e.type||"touchend"===e.type||"touchmove"===e.type){var a=e.touch;if(void 0===a)return;var s=a.pageX-(o+t.left),u=a.pageY-(i+t.top),l={x:s*=r/t.width,y:u*=n/t.height};if("touchstart"===e.type)Browser.lastTouches[a.identifier]=l,Browser.touches[a.identifier]=l;else if("touchend"===e.type||"touchmove"===e.type){var c=Browser.touches[a.identifier];c||(c=l),Browser.lastTouches[a.identifier]=c,Browser.touches[a.identifier]=l}return}var m=e.pageX-(o+t.left),d=e.pageY-(i+t.top);m*=r/t.width,d*=n/t.height,Browser.mouseMovementX=m-Browser.mouseX,Browser.mouseMovementY=d-Browser.mouseY,Browser.mouseX=m,Browser.mouseY=d}},resizeListeners:[],updateResizeListeners:function(){var e=Module.canvas;Browser.resizeListeners.forEach(function(t){t(e.width,e.height)})},setCanvasSize:function(e,t,r){var n=Module.canvas;Browser.updateCanvasDimensions(n,e,t),r||Browser.updateResizeListeners()},windowedWidth:0,windowedHeight:0,setFullscreenCanvasSize:function(){if("undefined"!=typeof SDL){var e=HEAPU32[SDL.screen>>2];e|=8388608,HEAP32[SDL.screen>>2]=e}Browser.updateCanvasDimensions(Module.canvas),Browser.updateResizeListeners()},setWindowedCanvasSize:function(){if("undefined"!=typeof SDL){var e=HEAPU32[SDL.screen>>2];e&=-8388609,HEAP32[SDL.screen>>2]=e}Browser.updateCanvasDimensions(Module.canvas),Browser.updateResizeListeners()},updateCanvasDimensions:function(e,t,r){t&&r?(e.widthNative=t,e.heightNative=r):(t=e.widthNative,r=e.heightNative);var n=t,o=r;if(Module.forcedAspectRatio&&Module.forcedAspectRatio>0&&(n/o<Module.forcedAspectRatio?n=Math.round(o*Module.forcedAspectRatio):o=Math.round(n/Module.forcedAspectRatio)),(document.fullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement)===e.parentNode&&"undefined"!=typeof screen){var i=Math.min(screen.width/n,screen.height/o);n=Math.round(n*i),o=Math.round(o*i)}Browser.resizeCanvas?(e.width!=n&&(e.width=n),e.height!=o&&(e.height=o),void 0!==e.style&&(e.style.removeProperty("width"),e.style.removeProperty("height"))):(e.width!=t&&(e.width=t),e.height!=r&&(e.height=r),void 0!==e.style&&(n!=t||o!=r?(e.style.setProperty("width",n+"px","important"),e.style.setProperty("height",o+"px","important")):(e.style.removeProperty("width"),e.style.removeProperty("height"))))}};function __webgl_enable_ANGLE_instanced_arrays(e){var t=e.getExtension("ANGLE_instanced_arrays");if(t)return e.vertexAttribDivisor=function(e,r){t.vertexAttribDivisorANGLE(e,r)},e.drawArraysInstanced=function(e,r,n,o){t.drawArraysInstancedANGLE(e,r,n,o)},e.drawElementsInstanced=function(e,r,n,o,i){t.drawElementsInstancedANGLE(e,r,n,o,i)},1}function __webgl_enable_OES_vertex_array_object(e){var t=e.getExtension("OES_vertex_array_object");if(t)return e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)},1}function __webgl_enable_WEBGL_draw_buffers(e){var t=e.getExtension("WEBGL_draw_buffers");if(t)return e.drawBuffers=function(e,r){t.drawBuffersWEBGL(e,r)},1}function __webgl_enable_WEBGL_multi_draw(e){return!!(e.multiDrawWebgl=e.getExtension("WEBGL_multi_draw"))}var GL={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],byteSizeByTypeRoot:5120,byteSizeByType:[1,1,2,2,4,4,4,2,3,4,8],stringCache:{},unpackAlignment:4,recordError:function e(t){GL.lastError||(GL.lastError=t)},getNewId:function(e){for(var t=GL.counter++,r=e.length;r<t;r++)e[r]=null;return t},MAX_TEMP_BUFFER_SIZE:2097152,numTempVertexBuffersPerSize:64,log2ceilLookup:function(e){return 32-Math.clz32(0===e?0:e-1)},generateTempBuffers:function(e,t){var r=GL.log2ceilLookup(GL.MAX_TEMP_BUFFER_SIZE);t.tempVertexBufferCounters1=[],t.tempVertexBufferCounters2=[],t.tempVertexBufferCounters1.length=t.tempVertexBufferCounters2.length=r+1,t.tempVertexBuffers1=[],t.tempVertexBuffers2=[],t.tempVertexBuffers1.length=t.tempVertexBuffers2.length=r+1,t.tempIndexBuffers=[],t.tempIndexBuffers.length=r+1;for(var n=0;n<=r;++n){t.tempIndexBuffers[n]=null,t.tempVertexBufferCounters1[n]=t.tempVertexBufferCounters2[n]=0;var o=GL.numTempVertexBuffersPerSize;t.tempVertexBuffers1[n]=[],t.tempVertexBuffers2[n]=[];var i=t.tempVertexBuffers1[n],a=t.tempVertexBuffers2[n];i.length=a.length=o;for(var s=0;s<o;++s)i[s]=a[s]=null}if(e){t.tempQuadIndexBuffer=GLctx.createBuffer(),t.GLctx.bindBuffer(34963,t.tempQuadIndexBuffer);for(var u=GL.MAX_TEMP_BUFFER_SIZE>>1,l=new Uint16Array(u),n=0,c=0;l[n++]=c,!(n>=u)&&(l[n++]=c+1,!(n>=u)&&(l[n++]=c+2,!(n>=u))&&(l[n++]=c,!(n>=u))&&(l[n++]=c+2,!(n>=u))&&(l[n++]=c+3,!(n>=u)));){c+=4}t.GLctx.bufferData(34963,l,35044),t.GLctx.bindBuffer(34963,null)}},getTempVertexBuffer:function e(t){var r=GL.log2ceilLookup(t),n=GL.currentContext.tempVertexBuffers1[r],o=GL.currentContext.tempVertexBufferCounters1[r];GL.currentContext.tempVertexBufferCounters1[r]=GL.currentContext.tempVertexBufferCounters1[r]+1&GL.numTempVertexBuffersPerSize-1;var i=n[o];if(i)return i;var a=GLctx.getParameter(34964);return n[o]=GLctx.createBuffer(),GLctx.bindBuffer(34962,n[o]),GLctx.bufferData(34962,1<<r,35048),GLctx.bindBuffer(34962,a),n[o]},getTempIndexBuffer:function e(t){var r=GL.log2ceilLookup(t),n=GL.currentContext.tempIndexBuffers[r];if(n)return n;var o=GLctx.getParameter(34965);return GL.currentContext.tempIndexBuffers[r]=GLctx.createBuffer(),GLctx.bindBuffer(34963,GL.currentContext.tempIndexBuffers[r]),GLctx.bufferData(34963,1<<r,35048),GLctx.bindBuffer(34963,o),GL.currentContext.tempIndexBuffers[r]},newRenderingFrameStarted:function e(){if(GL.currentContext){var t=GL.currentContext.tempVertexBuffers1;GL.currentContext.tempVertexBuffers1=GL.currentContext.tempVertexBuffers2,GL.currentContext.tempVertexBuffers2=t,t=GL.currentContext.tempVertexBufferCounters1,GL.currentContext.tempVertexBufferCounters1=GL.currentContext.tempVertexBufferCounters2,GL.currentContext.tempVertexBufferCounters2=t;for(var r=GL.log2ceilLookup(GL.MAX_TEMP_BUFFER_SIZE),n=0;n<=r;++n)GL.currentContext.tempVertexBufferCounters1[n]=0}},getSource:function(e,t,r,n){for(var o="",i=0;i<t;++i){var a=n?HEAP32[n+4*i>>2]:-1;o+=UTF8ToString(HEAP32[r+4*i>>2],a<0?void 0:a)}return 35632==GLctx.getShaderParameter(GL.shaders[e],35663)&&(GLEmulation.findToken(o,"dFdx")||GLEmulation.findToken(o,"dFdy")||GLEmulation.findToken(o,"fwidth"))&&(o="#extension GL_OES_standard_derivatives : enable\n"+o,GLctx.getExtension("OES_standard_derivatives")),o},enabledClientAttribIndices:[],enableVertexAttribArray:function e(t){GL.enabledClientAttribIndices[t]||(GL.enabledClientAttribIndices[t]=!0,GLctx.enableVertexAttribArray(t))},disableVertexAttribArray:function e(t){GL.enabledClientAttribIndices[t]&&(GL.enabledClientAttribIndices[t]=!1,GLctx.disableVertexAttribArray(t))},createContext:function(e,t){e.getContextSafariWebGL2Fixed||(e.getContextSafariWebGL2Fixed=e.getContext,e.getContext=function(t,r){var n=e.getContextSafariWebGL2Fixed(t,r);return"webgl"==t==n instanceof WebGLRenderingContext?n:null});var r=e.getContext("webgl",t);return r?GL.registerContext(r,t):0},registerContext:function(e,t){var r=GL.getNewId(GL.contexts),n={handle:r,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=n),GL.contexts[r]=n,(void 0===t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&GL.initExtensions(n),r},makeContextCurrent:function(e){return GL.currentContext=GL.contexts[e],Module.ctx=GLctx=GL.currentContext&&GL.currentContext.GLctx,!(e&&!GLctx)},getContext:function(e){return GL.contexts[e]},deleteContext:function(e){GL.currentContext===GL.contexts[e]&&(GL.currentContext=null),"object"==typeof JSEvents&&JSEvents.removeAllHandlersOnTarget(GL.contexts[e].GLctx.canvas),GL.contexts[e]&&GL.contexts[e].GLctx.canvas&&(GL.contexts[e].GLctx.canvas.GLctxObject=void 0),GL.contexts[e]=null},initExtensions:function(e){if(e||(e=GL.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t=e.GLctx;e.compressionExt=t.getExtension("WEBGL_compressed_texture_s3tc"),e.anisotropicExt=t.getExtension("EXT_texture_filter_anisotropic"),__webgl_enable_ANGLE_instanced_arrays(t),__webgl_enable_OES_vertex_array_object(t),__webgl_enable_WEBGL_draw_buffers(t),t.disjointTimerQueryExt=t.getExtension("EXT_disjoint_timer_query"),__webgl_enable_WEBGL_multi_draw(t),(t.getSupportedExtensions()||[]).forEach(function(e){e.includes("lose_context")||e.includes("debug")||t.getExtension(e)})}}};function _glEnable(e){GLctx.enable(e)}function _glDisable(e){GLctx.disable(e)}function _glIsEnabled(e){return GLctx.isEnabled(e)}function writeI53ToI64(e,t){HEAPU32[e>>2]=t,HEAPU32[e+4>>2]=(t-HEAPU32[e>>2])/4294967296}function emscriptenWebGLGet(e,t,r){if(!t){GL.recordError(1281);return}var n=void 0;switch(e){case 36346:n=1;break;case 36344:0!=r&&1!=r&&GL.recordError(1280);return;case 36345:n=0;break;case 34466:var o=GLctx.getParameter(34467);n=o?o.length:0}if(void 0===n){var i=GLctx.getParameter(e);switch(typeof i){case"number":n=i;break;case"boolean":n=i?1:0;break;case"string":GL.recordError(1280);return;case"object":if(null===i)switch(e){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 34068:n=0;break;default:GL.recordError(1280);return}else if(i instanceof Float32Array||i instanceof Uint32Array||i instanceof Int32Array||i instanceof Array){for(var a=0;a<i.length;++a)switch(r){case 0:HEAP32[t+4*a>>2]=i[a];break;case 2:HEAPF32[t+4*a>>2]=i[a];break;case 4:HEAP8[t+a>>0]=i[a]?1:0}return}else try{n=0|i.name}catch(s){GL.recordError(1280),err("GL_INVALID_ENUM in glGet"+r+"v: Unknown object returned from WebGL getParameter("+e+")! (error: "+s+")");return}break;default:GL.recordError(1280),err("GL_INVALID_ENUM in glGet"+r+"v: Native code calling glGet"+r+"v("+e+") and it returns "+i+" of type "+typeof i+"!");return}}switch(r){case 1:writeI53ToI64(t,n);break;case 0:HEAP32[t>>2]=n;break;case 2:HEAPF32[t>>2]=n;break;case 4:HEAP8[t>>0]=n?1:0}}function _glGetBooleanv(e,t){emscriptenWebGLGet(e,t,4)}function _glGetIntegerv(e,t){emscriptenWebGLGet(e,t,0)}function stringToNewUTF8(e){var t=lengthBytesUTF8(e)+1,r=_malloc(t);return stringToUTF8(e,r,t),r}function _glGetString(e){var t=GL.stringCache[e];if(!t){switch(e){case 7939:var r=GLctx.getSupportedExtensions()||[];t=stringToNewUTF8((r=r.concat(r.map(function(e){return"GL_"+e}))).join(" "));break;case 7936:case 7937:case 37445:case 37446:var n=GLctx.getParameter(e);n||GL.recordError(1280),t=n&&stringToNewUTF8(n);break;case 7938:var o=GLctx.getParameter(7938);t=stringToNewUTF8(o="OpenGL ES 2.0 ("+o+")");break;case 35724:var i=GLctx.getParameter(35724),a=i.match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);null!==a&&(3==a[1].length&&(a[1]=a[1]+"0"),i="OpenGL ES GLSL ES "+a[1]+" ("+i+")"),t=stringToNewUTF8(i);break;default:GL.recordError(1280)}GL.stringCache[e]=t}return t}function _glCreateShader(e){var t=GL.getNewId(GL.shaders);return GL.shaders[t]=GLctx.createShader(e),t}function _glShaderSource(e,t,r,n){var o=GL.getSource(e,t,r,n);GLctx.shaderSource(GL.shaders[e],o)}function _glCompileShader(e){GLctx.compileShader(GL.shaders[e])}function _glAttachShader(e,t){GLctx.attachShader(GL.programs[e],GL.shaders[t])}function _glDetachShader(e,t){GLctx.detachShader(GL.programs[e],GL.shaders[t])}function _glUseProgram(e){e=GL.programs[e],GLctx.useProgram(e),GLctx.currentProgram=e}function _glDeleteProgram(e){if(e){var t=GL.programs[e];if(!t){GL.recordError(1281);return}GLctx.deleteProgram(t),t.name=0,GL.programs[e]=null}}function _glBindAttribLocation(e,t,r){GLctx.bindAttribLocation(GL.programs[e],t,UTF8ToString(r))}function _glLinkProgram(e){e=GL.programs[e],GLctx.linkProgram(e),e.uniformLocsById=0,e.uniformSizeAndIdsByName={}}function _glBindBuffer(e,t){34962==e?(GLctx.currentArrayBufferBinding=t,GLImmediate.lastArrayBuffer=t):34963==e&&(GLctx.currentElementArrayBufferBinding=t),GLctx.bindBuffer(e,GL.buffers[t])}function _glGetFloatv(e,t){emscriptenWebGLGet(e,t,2)}function _glHint(e,t){GLctx.hint(e,t)}function _glEnableVertexAttribArray(e){GLctx.enableVertexAttribArray(e)}function _glDisableVertexAttribArray(e){GLctx.disableVertexAttribArray(e)}function _glVertexAttribPointer(e,t,r,n,o,i){GLctx.vertexAttribPointer(e,t,r,!!n,o,i)}function _glActiveTexture(e){GLctx.activeTexture(e)}var GLEmulation={fogStart:0,fogEnd:1,fogDensity:1,fogColor:null,fogMode:2048,fogEnabled:!1,MAX_CLIP_PLANES:6,clipPlaneEnabled:[!1,!1,!1,!1,!1,!1],clipPlaneEquation:[],lightingEnabled:!1,lightModelAmbient:null,lightModelLocalViewer:!1,lightModelTwoSide:!1,materialAmbient:null,materialDiffuse:null,materialSpecular:null,materialShininess:null,materialEmission:null,MAX_LIGHTS:8,lightEnabled:[!1,!1,!1,!1,!1,!1,!1,!1],lightAmbient:[],lightDiffuse:[],lightSpecular:[],lightPosition:[],alphaTestEnabled:!1,alphaTestFunc:519,alphaTestRef:0,pointSize:1,vaos:[],currentVao:null,enabledVertexAttribArrays:{},hasRunInit:!1,findToken:function(e,t){function r(e){return!!(e>=48)&&!!(e<=57)||!!(e>=65)&&!!(e<=90)||!!(e>=97)&&!!(e<=122)}for(var n=-1;!((n=e.indexOf(t,n+1))<0);)if(!(n>0&&r(e[n-1])||(n+=t.length)<e.length-1&&r(e[n+1])))return!0;return!1},init:function(){if(!GLEmulation.hasRunInit){GLEmulation.hasRunInit=!0,GLEmulation.fogColor=new Float32Array(4);for(var e=0;e<GLEmulation.MAX_CLIP_PLANES;e++)GLEmulation.clipPlaneEquation[e]=new Float32Array(4);GLEmulation.lightModelAmbient=new Float32Array([.2,.2,.2,1]),GLEmulation.materialAmbient=new Float32Array([.2,.2,.2,1]),GLEmulation.materialDiffuse=new Float32Array([.8,.8,.8,1]),GLEmulation.materialSpecular=new Float32Array([0,0,0,1]),GLEmulation.materialShininess=new Float32Array([0]),GLEmulation.materialEmission=new Float32Array([0,0,0,1]);for(var t=0;t<GLEmulation.MAX_LIGHTS;t++)GLEmulation.lightAmbient[t]=new Float32Array([0,0,0,1]),GLEmulation.lightDiffuse[t]=new Float32Array(t?[0,0,0,1]:[1,1,1,1]),GLEmulation.lightSpecular[t]=new Float32Array(t?[0,0,0,1]:[1,1,1,1]),GLEmulation.lightPosition[t]=new Float32Array([0,0,1,0]);err("WARNING: using emscripten GL emulation. This is a collection of limited workarounds, do not expect it to work."),err("WARNING: using emscripten GL emulation unsafe opts. If weirdness happens, try -s GL_UNSAFE_OPTS=0");var r={2884:1,3042:1,3024:1,2960:1,2929:1,3089:1,32823:1,32926:1,32928:1},n=_glEnable;_glEnable=_emscripten_glEnable=function e(t){if(GLImmediate.lastRenderer&&GLImmediate.lastRenderer.cleanup(),2912==t){!0!=GLEmulation.fogEnabled&&(GLImmediate.currentRenderer=null,GLEmulation.fogEnabled=!0);return}if(t>=12288&&t<12294){var o=t-12288;!0!=GLEmulation.clipPlaneEnabled[o]&&(GLImmediate.currentRenderer=null,GLEmulation.clipPlaneEnabled[o]=!0);return}if(t>=16384&&t<16392){var i=t-16384;!0!=GLEmulation.lightEnabled[i]&&(GLImmediate.currentRenderer=null,GLEmulation.lightEnabled[i]=!0);return}if(2896==t){!0!=GLEmulation.lightingEnabled&&(GLImmediate.currentRenderer=null,GLEmulation.lightingEnabled=!0);return}if(3008==t){!0!=GLEmulation.alphaTestEnabled&&(GLImmediate.currentRenderer=null,GLEmulation.alphaTestEnabled=!0);return}else if(3553==t)return;else if(!(t in r))return;n(t)};var o=_glDisable;_glDisable=_emscripten_glDisable=function e(t){if(GLImmediate.lastRenderer&&GLImmediate.lastRenderer.cleanup(),2912==t){!1!=GLEmulation.fogEnabled&&(GLImmediate.currentRenderer=null,GLEmulation.fogEnabled=!1);return}if(t>=12288&&t<12294){var n=t-12288;!1!=GLEmulation.clipPlaneEnabled[n]&&(GLImmediate.currentRenderer=null,GLEmulation.clipPlaneEnabled[n]=!1);return}if(t>=16384&&t<16392){var i=t-16384;!1!=GLEmulation.lightEnabled[i]&&(GLImmediate.currentRenderer=null,GLEmulation.lightEnabled[i]=!1);return}if(2896==t){!1!=GLEmulation.lightingEnabled&&(GLImmediate.currentRenderer=null,GLEmulation.lightingEnabled=!1);return}if(3008==t){!1!=GLEmulation.alphaTestEnabled&&(GLImmediate.currentRenderer=null,GLEmulation.alphaTestEnabled=!1);return}else if(3553==t)return;else if(!(t in r))return;o(t)},_glIsEnabled=_emscripten_glIsEnabled=function e(t){if(2912==t)return GLEmulation.fogEnabled?1:0;if(t>=12288&&t<12294)return GLEmulation.clipPlaneEnabled[t-12288]?1:0;if(t>=16384&&t<16392)return GLEmulation.lightEnabled[t-16384]?1:0;if(2896==t)return GLEmulation.lightingEnabled?1:0;if(3008==t)return GLEmulation.alphaTestEnabled?1:0;else if(!(t in r))return 0;return GLctx.isEnabled(t)};var i=_glGetBooleanv;_glGetBooleanv=_emscripten_glGetBooleanv=function e(t,r){var n=GLEmulation.getAttributeFromCapability(t);if(null!==n){var o=GLImmediate.enabledClientAttributes[n];HEAP8[r>>0]=!0===o?1:0;return}i(t,r)};var a=_glGetIntegerv;_glGetIntegerv=_emscripten_glGetIntegerv=function e(t,r){switch(t){case 34018:t=GLctx.MAX_TEXTURE_IMAGE_UNITS;break;case 35658:var n=GLctx.getParameter(GLctx.MAX_VERTEX_UNIFORM_VECTORS);HEAP32[r>>2]=4*n;return;case 35657:var n=GLctx.getParameter(GLctx.MAX_FRAGMENT_UNIFORM_VECTORS);HEAP32[r>>2]=4*n;return;case 35659:var n=GLctx.getParameter(GLctx.MAX_VARYING_VECTORS);HEAP32[r>>2]=4*n;return;case 34929:t=GLctx.MAX_COMBINED_TEXTURE_IMAGE_UNITS;break;case 32890:var o=GLImmediate.clientAttributes[GLImmediate.VERTEX];HEAP32[r>>2]=o?o.size:0;return;case 32891:var o=GLImmediate.clientAttributes[GLImmediate.VERTEX];HEAP32[r>>2]=o?o.type:0;return;case 32892:var o=GLImmediate.clientAttributes[GLImmediate.VERTEX];HEAP32[r>>2]=o?o.stride:0;return;case 32897:var o=GLImmediate.clientAttributes[GLImmediate.COLOR];HEAP32[r>>2]=o?o.size:0;return;case 32898:var o=GLImmediate.clientAttributes[GLImmediate.COLOR];HEAP32[r>>2]=o?o.type:0;return;case 32899:var o=GLImmediate.clientAttributes[GLImmediate.COLOR];HEAP32[r>>2]=o?o.stride:0;return;case 32904:var o=GLImmediate.clientAttributes[GLImmediate.TEXTURE0+GLImmediate.clientActiveTexture];HEAP32[r>>2]=o?o.size:0;return;case 32905:var o=GLImmediate.clientAttributes[GLImmediate.TEXTURE0+GLImmediate.clientActiveTexture];HEAP32[r>>2]=o?o.type:0;return;case 32906:var o=GLImmediate.clientAttributes[GLImmediate.TEXTURE0+GLImmediate.clientActiveTexture];HEAP32[r>>2]=o?o.stride:0;return;case 3378:HEAP32[r>>2]=GLEmulation.MAX_CLIP_PLANES;return;case 2976:HEAP32[r>>2]=GLImmediate.currentMatrix+5888;return;case 3009:HEAP32[r>>2]=GLEmulation.alphaTestFunc;return}a(t,r)};var s=_glGetString;_glGetString=_emscripten_glGetString=function e(t){if(GL.stringCache[t])return GL.stringCache[t];if(7939===t){var r=stringToNewUTF8((GLctx.getSupportedExtensions()||[]).join(" ")+" GL_EXT_texture_env_combine GL_ARB_texture_env_crossbar GL_ATI_texture_env_combine3 GL_NV_texture_env_combine4 GL_EXT_texture_env_dot3 GL_ARB_multitexture GL_ARB_vertex_buffer_object GL_EXT_framebuffer_object GL_ARB_vertex_program GL_ARB_fragment_program GL_ARB_shading_language_100 GL_ARB_shader_objects GL_ARB_vertex_shader GL_ARB_fragment_shader GL_ARB_texture_cube_map GL_EXT_draw_range_elements"+(GL.currentContext.compressionExt?" GL_ARB_texture_compression GL_EXT_texture_compression_s3tc":"")+(GL.currentContext.anisotropicExt?" GL_EXT_texture_filter_anisotropic":""));return GL.stringCache[t]=r,r}return s(t)},GL.shaderInfos={};var u=_glCreateShader;_glCreateShader=_emscripten_glCreateShader=function e(t){var r=u(t);return GL.shaderInfos[r]={type:t,ftransform:!1},r},_glShaderSource=_emscripten_glShaderSource=function e(t,r,n,o){var i,a=GL.getSource(t,r,n,o);if(GL.shaderInfos[t].type==GLctx.VERTEX_SHADER){var s=a.search(/u_projection/)>=0,u=a.search(/u_modelView/)>=0,l=a.search(/a_position/)>=0,c=0,m=0,d=0,f=a;f!=(a=a.replace(/ftransform\(\)/g,"(u_projection * u_modelView * a_position)"))&&(c=m=d=1),(f=a)!=(a=a.replace(/gl_ProjectionMatrix/g,"u_projection"))&&(c=1),(f=a)!=(a=a.replace(/gl_ModelViewMatrixTranspose\[2\]/g,"vec4(u_modelView[0][2], u_modelView[1][2], u_modelView[2][2], u_modelView[3][2])"))&&(m=1),(f=a)!=(a=a.replace(/gl_ModelViewMatrix/g,"u_modelView"))&&(m=1),(f=a)!=(a=a.replace(/gl_Vertex/g,"a_position"))&&(d=1),(f=a)!=(a=a.replace(/gl_ModelViewProjectionMatrix/g,"(u_projection * u_modelView)"))&&(c=m=1),d&&!l&&(a="attribute vec4 a_position; \n"+a),m&&!u&&(a="uniform mat4 u_modelView; \n"+a),c&&!s&&(a="uniform mat4 u_projection; \n"+a),GL.shaderInfos[t].ftransform=c||m||d;for(var p=0;p<GLImmediate.MAX_TEXTURES;p++){f=a;var h=-1==a.search("v_texCoord"+p);(a=a.replace(RegExp("gl_TexCoord\\["+p+"\\]","g"),"v_texCoord"+p).replace(RegExp("gl_MultiTexCoord"+p,"g"),"a_texCoord"+p))!=f&&(a="attribute vec4 a_texCoord"+p+"; \n"+a,h&&(a="varying vec4 v_texCoord"+p+";   \n"+a)),f=a,(a=a.replace(RegExp("gl_TextureMatrix\\["+p+"\\]","g"),"u_textureMatrix"+p))!=f&&(a="uniform mat4 u_textureMatrix"+p+"; \n"+a)}a.includes("gl_FrontColor")&&(a="varying vec4 v_color; \n"+a.replace(/gl_FrontColor/g,"v_color")),a.includes("gl_Color")&&(a="attribute vec4 a_color; \n"+a.replace(/gl_Color/g,"a_color")),a.includes("gl_Normal")&&(a="attribute vec3 a_normal; \n"+a.replace(/gl_Normal/g,"a_normal")),a.includes("gl_FogFragCoord")&&(a="varying float v_fogFragCoord;   \n"+a.replace(/gl_FogFragCoord/g,"v_fogFragCoord"))}else{for(p=0;p<GLImmediate.MAX_TEXTURES;p++)f=a,(a=a.replace(RegExp("gl_TexCoord\\["+p+"\\]","g"),"v_texCoord"+p))!=f&&(a="varying vec4 v_texCoord"+p+";   \n"+a);a.includes("gl_Color")&&(a="varying vec4 v_color; \n"+a.replace(/gl_Color/g,"v_color")),a.includes("gl_Fog.color")&&(a="uniform vec4 u_fogColor;   \n"+a.replace(/gl_Fog.color/g,"u_fogColor")),a.includes("gl_Fog.end")&&(a="uniform float u_fogEnd;   \n"+a.replace(/gl_Fog.end/g,"u_fogEnd")),a.includes("gl_Fog.scale")&&(a="uniform float u_fogScale;   \n"+a.replace(/gl_Fog.scale/g,"u_fogScale")),a.includes("gl_Fog.density")&&(a="uniform float u_fogDensity;   \n"+a.replace(/gl_Fog.density/g,"u_fogDensity")),a.includes("gl_FogFragCoord")&&(a="varying float v_fogFragCoord;   \n"+a.replace(/gl_FogFragCoord/g,"v_fogFragCoord")),a=(i=a,/precision +(low|medium|high)p +float *;/.test(i)||(i="#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n"+i),i)}GLctx.shaderSource(GL.shaders[t],a)},_glCompileShader=_emscripten_glCompileShader=function e(t){GLctx.compileShader(GL.shaders[t])},GL.programShaders={};var l=_glAttachShader;_glAttachShader=_emscripten_glAttachShader=function e(t,r){GL.programShaders[t]||(GL.programShaders[t]=[]),GL.programShaders[t].push(r),l(t,r)};var c=_glDetachShader;_glDetachShader=_emscripten_glDetachShader=function e(t,r){var n=GL.programShaders[t];if(!n){err("WARNING: _glDetachShader received invalid program: "+t);return}var o=n.indexOf(r);n.splice(o,1),c(t,r)};var m=_glUseProgram;_glUseProgram=_emscripten_glUseProgram=function e(t){GL.currProgram!=t&&(GLImmediate.currentRenderer=null,GL.currProgram=t,GLImmediate.fixedFunctionProgram=0,m(t))};var d=_glDeleteProgram;_glDeleteProgram=_emscripten_glDeleteProgram=function e(t){d(t),t==GL.currProgram&&(GLImmediate.currentRenderer=null,GL.currProgram=0)};var f={},p=_glBindAttribLocation;_glBindAttribLocation=_emscripten_glBindAttribLocation=function e(t,r,n){0==r&&(f[t]=!0),p(t,r,n)};var h=_glLinkProgram;_glLinkProgram=_emscripten_glLinkProgram=function e(t){t in f||GLctx.bindAttribLocation(GL.programs[t],0,"a_position"),h(t)};var L=_glBindBuffer;_glBindBuffer=_emscripten_glBindBuffer=function e(t,r){L(t,r),t==GLctx.ARRAY_BUFFER?GLEmulation.currentVao&&(GLEmulation.currentVao.arrayBuffer=r):t==GLctx.ELEMENT_ARRAY_BUFFER&&GLEmulation.currentVao&&(GLEmulation.currentVao.elementArrayBuffer=r)};var g=_glGetFloatv;_glGetFloatv=_emscripten_glGetFloatv=function e(t,r){2982==t?HEAPF32.set(GLImmediate.matrix[0],r>>2):2983==t?HEAPF32.set(GLImmediate.matrix[1],r>>2):2984==t?HEAPF32.set(GLImmediate.matrix[2+GLImmediate.clientActiveTexture],r>>2):2918==t?HEAPF32.set(GLEmulation.fogColor,r>>2):2915==t?HEAPF32[r>>2]=GLEmulation.fogStart:2916==t?HEAPF32[r>>2]=GLEmulation.fogEnd:2914==t?HEAPF32[r>>2]=GLEmulation.fogDensity:2917==t?HEAPF32[r>>2]=GLEmulation.fogMode:2899==t?(HEAPF32[r>>2]=GLEmulation.lightModelAmbient[0],HEAPF32[r+4>>2]=GLEmulation.lightModelAmbient[1],HEAPF32[r+8>>2]=GLEmulation.lightModelAmbient[2],HEAPF32[r+12>>2]=GLEmulation.lightModelAmbient[3]):3010==t?HEAPF32[r>>2]=GLEmulation.alphaTestRef:g(t,r)};var $=_glHint;_glHint=_emscripten_glHint=function e(t,r){34031!=t&&$(t,r)};var _=_glEnableVertexAttribArray;_glEnableVertexAttribArray=_emscripten_glEnableVertexAttribArray=function e(t){_(t),GLEmulation.enabledVertexAttribArrays[t]=1,GLEmulation.currentVao&&(GLEmulation.currentVao.enabledVertexAttribArrays[t]=1)};var v=_glDisableVertexAttribArray;_glDisableVertexAttribArray=_emscripten_glDisableVertexAttribArray=function e(t){v(t),delete GLEmulation.enabledVertexAttribArrays[t],GLEmulation.currentVao&&delete GLEmulation.currentVao.enabledVertexAttribArrays[t]};var E=_glVertexAttribPointer;_glVertexAttribPointer=_emscripten_glVertexAttribPointer=function e(t,r,n,o,i,a){E(t,r,n,o,i,a),GLEmulation.currentVao&&(GLEmulation.currentVao.vertexAttribPointers[t]=[t,r,n,o,i,a])}}},getAttributeFromCapability:function(e){var t=null;switch(e){case 3553:case 32888:t=GLImmediate.TEXTURE0+GLImmediate.clientActiveTexture;break;case 32884:t=GLImmediate.VERTEX;break;case 32885:t=GLImmediate.NORMAL;break;case 32886:t=GLImmediate.COLOR}return t}},GLImmediate={MapTreeLib:null,spawnMapTreeLib:function(){function e(){var e,t,r=[];this.insert=function e(t,n){return!this.contains(0|t)&&(r.push([t,n]),!0)},this.contains=function t(n){for(e=0;e<r.length;++e)if(r[e][0]===n)return!0;return!1},this.get=function e(n){for(t=0;t<r.length;++t)if(r[t][0]===n)return r[t][1]}}function t(){var t,r;function n(){var t=new e;this.child=function e(r){return t.contains(0|r)||t.insert(0|r,new n),t.get(0|r)},this.value=void 0,this.get=function e(){return this.value},this.set=function e(t){this.value=t}}function o(e){var t;this.reset=function r(){return t=e,this},this.reset(),this.next=function e(r){return t=t.child(r),this},this.get=function e(){return t.get()},this.set=function e(r){t.set(r)}}this.createKeyView=function e(){return new o(t)},this.clear=function e(){t=new n,r=this.createKeyView()},this.clear(),this.getStaticKeyView=function e(){return r.reset(),r}}return{create:function(){return new t}}},TexEnvJIT:null,spawnTexEnvJIT:function(){var e="tej_",t="uTexUnit",r="vTexCoord",n="vPrimColor",o="uTexMatrix",i=null,a=0,s=[];function u(e){assert(!1,"[TexEnvJIT] ABORT: "+e)}function l(e){u("No support: "+e)}function c(e){u("Sanity failure: "+e)}function m(e){var n=i[e].getTexType(),a=null;switch(n){case 3552:case 3553:a="texture2D";break;case 32879:return l("No support for 3D textures.");case 34067:a="textureCube";break;default:return c("Unknown texType: 0x"+n.toString(16))}var s=r+e;return null!=o&&(s="("+o+e+" * "+s+")"),a+"("+t+e+", "+s+".xy)"}function d(){return i[a]}function f(e,t,r,o,i){var a=null;switch(o){case 5890:a=m(e);break;case 34166:a=t;break;case 34167:a=n;break;case 34168:a=r;break;default:return l("Unsupported combiner src: 0x"+o.toString(16))}var s=null;switch(i){case 768:s=a+".rgb";break;case 769:s="(vec3(1.0) - "+a+".rgb)";break;case 770:s=a+".a";break;case 771:s="(1.0 - "+a+".a)";break;default:return l("Unsupported combiner op: 0x"+i.toString(16))}return s}function p(e){return e==Math.round(e)?e+".0":e}function h(){this.mode=8448,this.colorCombiner=8448,this.alphaCombiner=8448,this.colorScale=1,this.alphaScale=1,this.envColor=[0,0,0,0],this.colorSrc=[5890,34168,34166],this.alphaSrc=[5890,34168,34166],this.colorOp=[768,768,770],this.alphaOp=[770,770,770],this.traverseKey={7681:0,8448:1,260:2,3042:3,8449:4,34160:5,34023:3,34165:4,5890:0,34166:1,34167:2,34168:3,768:0,769:1,770:2,771:3},this.key0=-1,this.key1=0,this.key2=0,this.computeKey0=function(){var e=this.traverseKey,t=1638400*e[this.mode];return t+=327680*e[this.colorCombiner],t+=65536*e[this.alphaCombiner],t+=(this.colorScale-1)*16384,t+=(this.alphaScale-1)*4096,t+=1024*e[this.colorSrc[0]],t+=256*e[this.colorSrc[1]],t+=64*e[this.colorSrc[2]],t+=16*e[this.alphaSrc[0]],t+=4*e[this.alphaSrc[1]],t+=e[this.alphaSrc[2]]},this.computeKey1=function(){var e=this.traverseKey,t=4096*e[this.colorOp[0]];return t+=1024*e[this.colorOp[1]],t+=256*e[this.colorOp[2]],t+=16*e[this.alphaOp[0]],t+=4*e[this.alphaOp[1]],t+=e[this.alphaOp[2]]},this.computeKey2=function(){return 16777216*this.envColor[0]+65536*this.envColor[1]+256*this.envColor[2]+1+this.envColor[3]},this.recomputeKey=function(){this.key0=this.computeKey0(),this.key1=this.computeKey1(),this.key2=this.computeKey2()},this.invalidateKey=function(){this.key0=-1,GLImmediate.currentRenderer=null}}function L(){this.env=new h,this.enabled_tex1D=!1,this.enabled_tex2D=!1,this.enabled_tex3D=!1,this.enabled_texCube=!1,this.texTypesEnabled=0,this.traverseState=function e(t){this.texTypesEnabled?(-1==this.env.key0&&this.env.recomputeKey(),t.next(this.texTypesEnabled|this.env.key0<<4),t.next(this.env.key1),t.next(this.env.key2)):t.next(0)}}return L.prototype.enabled=function e(){return this.texTypesEnabled},L.prototype.genPassLines=function t(r,n,o){if(!this.enabled())return["vec4 "+r+" = "+n+";"];for(var i,a=this.env.genPassLines(r,n,o).join("\n"),s="",u=/(texture.*?\(.*?\))/g,l=0;i=u.exec(a);){var c=i[1];if(-1!=a.slice(i.index+1).indexOf(c)){var m=e+"env"+o+"_texload"+l++;s+="vec4 "+m+" = "+c+";\n\n",a=a.split(c).join(m),u=/(texture.*\(.*\))/g}}return[s+a]},L.prototype.getTexType=function e(){return this.enabled_texCube?34067:this.enabled_tex3D?32879:this.enabled_tex2D?3553:this.enabled_tex1D?3552:0},h.prototype.genPassLines=function t(r,o,i){switch(this.mode){case 7681:return["vec4 "+r+" = "+m(i)+";"];case 260:var a=e+"env"+i+"_",s=a+"tex",u=a+"color",c=a+"alpha";return["vec4 "+s+" = "+m(i)+";","vec3 "+u+" = "+o+".rgb + "+s+".rgb;","float "+c+" = "+o+".a * "+s+".a;","vec4 "+r+" = vec4("+u+", "+c+");"];case 8448:var d=["vec4 "+r," = ",o," * ",m(i),";"];return[d.join("")];case 8449:var a=e+"env"+i+"_",s=a+"tex",u=a+"color",c=a+"alpha";return["vec4 "+s+" = "+m(i)+";",["vec3 "+u+" = ",o+".rgb * (1.0 - "+s+".a)"," + ",s+".rgb * "+s+".a",";"].join(""),"float "+c+" = "+o+".a;","vec4 "+r+" = vec4("+u+", "+c+");"];case 3042:var a=e+"env"+i+"_",s=a+"tex",u=a+"color",c=a+"alpha";return["vec4 "+s+" = "+m(i)+";",["vec3 "+u+" = ",o+".rgb * (1.0 - "+s+".rgb)"," + ",n+".rgb * "+s+".rgb",";"].join(""),"float "+c+" = "+s+".a;","vec4 "+r+" = vec4("+u+", "+c+");"];case 34160:var a=e+"env"+i+"_",u=a+"color",c=a+"alpha",f=this.genCombinerLines(!0,u,o,i,this.colorCombiner,this.colorSrc,this.colorOp),h=this.genCombinerLines(!1,c,o,i,this.alphaCombiner,this.alphaSrc,this.alphaOp),L=1==this.colorScale?u:u+" * "+p(this.colorScale),g=1==this.alphaScale?c:c+" * "+p(this.alphaScale),d=["vec4 "+r," = ","vec4(",L,", ",g,")",";"].join("");return[].concat(f,h,[d])}return l("Unsupported TexEnv mode: 0x"+this.mode.toString(16))},h.prototype.genCombinerLines=function t(r,n,o,i,a,s,u){var m=null;switch(a){case 7681:m=1;break;case 8448:case 260:case 34023:m=2;break;case 34165:m=3;break;default:return l("Unsupported combiner: 0x"+a.toString(16))}var d=["vec4(",p(this.envColor[0]),", ",p(this.envColor[1]),", ",p(this.envColor[2]),", ",p(this.envColor[3]),")"].join(""),h=m>=1?f(i,d,o,s[0],u[0]):null,L=m>=2?f(i,d,o,s[1],u[1]):null,g=m>=3?f(i,d,o,s[2],u[2]):null,$=r?"vec3":"float",_=null;switch(a){case 7681:var v=[$+" "+n," = ",h,";"];_=[v.join("")];break;case 8448:var v=[$+" "+n+" = ",h+" * "+L,";"];_=[v.join("")];break;case 260:var v=[$+" "+n+" = ",h+" + "+L,";"];_=[v.join("")];break;case 34023:var v=[$+" "+n+" = ",h+" - "+L,";"];_=[v.join("")];break;case 34165:var E=e+"env"+i+"_colorSrc2",G=function e(t){switch(t){case 768:case 769:return"vec3";case 770:case 771:return"float"}return l("Unsupported combiner op: 0x"+t.toString(16))}(this.colorOp[2])+" "+E+" = "+g+";",v=[$+" "+n," = ",h+" * "+E," + ",L+" * (1.0 - "+E+")",";"];_=[G,v.join("")];break;default:return c("Unmatched TexEnv.colorCombiner?")}return _},{init:function(e,t){var r=0;t?r=t:e&&(r=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)),i=[];for(var n=0;n<r;n++)i.push(new L)},setGLSLVars:function(e,i,a,s){t=e,r=i,n=a,o=s},genAllPassLines:function(t,r){r=r||0,s.length=0;for(var o=[],a=n,u=0;u<i.length;u++)if(i[u].enabled()){s.push(u);var l=e+"env"+u+"_result",c=i[u].genPassLines(l,a,u);o=o.concat(c,[""]),a=l}o.push(t+" = "+a+";");for(var m="",u=0;u<r;u++)m+=" ";return m+o.join("\n"+m)},getUsedTexUnitList:function(){return s},getActiveTexture:function(){return a},traverseState:function(e){for(var t=0;t<i.length;t++)i[t].traverseState(e)},getTexUnitType:function(e){return i[e].getTexType()},hook_activeTexture:function(e){a=e-33984,GLImmediate.currentMatrix>=2&&(GLImmediate.currentMatrix=2+a)},hook_enable:function(e){var t=d();switch(e){case 3552:t.enabled_tex1D||(GLImmediate.currentRenderer=null,t.enabled_tex1D=!0,t.texTypesEnabled|=1);break;case 3553:t.enabled_tex2D||(GLImmediate.currentRenderer=null,t.enabled_tex2D=!0,t.texTypesEnabled|=2);break;case 32879:t.enabled_tex3D||(GLImmediate.currentRenderer=null,t.enabled_tex3D=!0,t.texTypesEnabled|=4);break;case 34067:t.enabled_texCube||(GLImmediate.currentRenderer=null,t.enabled_texCube=!0,t.texTypesEnabled|=8)}},hook_disable:function(e){var t=d();switch(e){case 3552:t.enabled_tex1D&&(GLImmediate.currentRenderer=null,t.enabled_tex1D=!1,t.texTypesEnabled&=-2);break;case 3553:t.enabled_tex2D&&(GLImmediate.currentRenderer=null,t.enabled_tex2D=!1,t.texTypesEnabled&=-3);break;case 32879:t.enabled_tex3D&&(GLImmediate.currentRenderer=null,t.enabled_tex3D=!1,t.texTypesEnabled&=-5);break;case 34067:t.enabled_texCube&&(GLImmediate.currentRenderer=null,t.enabled_texCube=!1,t.texTypesEnabled&=-9)}},hook_texEnvf:function(e,t,r){if(8960==e){var n=d().env;switch(t){case 34163:n.colorScale!=r&&(n.invalidateKey(),n.colorScale=r);break;case 3356:n.alphaScale!=r&&(n.invalidateKey(),n.alphaScale=r);break;default:err("WARNING: Unhandled `pname` in call to `glTexEnvf`.")}}},hook_texEnvi:function(e,t,r){if(8960==e){var n=d().env;switch(t){case 8704:n.mode!=r&&(n.invalidateKey(),n.mode=r);break;case 34161:n.colorCombiner!=r&&(n.invalidateKey(),n.colorCombiner=r);break;case 34162:n.alphaCombiner!=r&&(n.invalidateKey(),n.alphaCombiner=r);break;case 34176:n.colorSrc[0]!=r&&(n.invalidateKey(),n.colorSrc[0]=r);break;case 34177:n.colorSrc[1]!=r&&(n.invalidateKey(),n.colorSrc[1]=r);break;case 34178:n.colorSrc[2]!=r&&(n.invalidateKey(),n.colorSrc[2]=r);break;case 34184:n.alphaSrc[0]!=r&&(n.invalidateKey(),n.alphaSrc[0]=r);break;case 34185:n.alphaSrc[1]!=r&&(n.invalidateKey(),n.alphaSrc[1]=r);break;case 34186:n.alphaSrc[2]!=r&&(n.invalidateKey(),n.alphaSrc[2]=r);break;case 34192:n.colorOp[0]!=r&&(n.invalidateKey(),n.colorOp[0]=r);break;case 34193:n.colorOp[1]!=r&&(n.invalidateKey(),n.colorOp[1]=r);break;case 34194:n.colorOp[2]!=r&&(n.invalidateKey(),n.colorOp[2]=r);break;case 34200:n.alphaOp[0]!=r&&(n.invalidateKey(),n.alphaOp[0]=r);break;case 34201:n.alphaOp[1]!=r&&(n.invalidateKey(),n.alphaOp[1]=r);break;case 34202:n.alphaOp[2]!=r&&(n.invalidateKey(),n.alphaOp[2]=r);break;case 34163:n.colorScale!=r&&(n.invalidateKey(),n.colorScale=r);break;case 3356:n.alphaScale!=r&&(n.invalidateKey(),n.alphaScale=r);break;default:err("WARNING: Unhandled `pname` in call to `glTexEnvi`.")}}},hook_texEnvfv:function(e,t,r){if(8960==e){var n=d().env;if(8705===t)for(var o=0;o<4;o++){var i=HEAPF32[r+4*o>>2];n.envColor[o]!=i&&(n.invalidateKey(),n.envColor[o]=i)}else err("WARNING: Unhandled `pname` in call to `glTexEnvfv`.")}},hook_getTexEnviv:function(e,t,r){if(8960==e){var n=d().env;switch(t){case 8704:HEAP32[r>>2]=n.mode;return;case 8705:HEAP32[r>>2]=Math.max(Math.min(255*n.envColor[0],255,-255)),HEAP32[r+1>>2]=Math.max(Math.min(255*n.envColor[1],255,-255)),HEAP32[r+2>>2]=Math.max(Math.min(255*n.envColor[2],255,-255)),HEAP32[r+3>>2]=Math.max(Math.min(255*n.envColor[3],255,-255));return;case 34161:HEAP32[r>>2]=n.colorCombiner;return;case 34162:HEAP32[r>>2]=n.alphaCombiner;return;case 34176:HEAP32[r>>2]=n.colorSrc[0];return;case 34177:HEAP32[r>>2]=n.colorSrc[1];return;case 34178:HEAP32[r>>2]=n.colorSrc[2];return;case 34184:HEAP32[r>>2]=n.alphaSrc[0];return;case 34185:HEAP32[r>>2]=n.alphaSrc[1];return;case 34186:HEAP32[r>>2]=n.alphaSrc[2];return;case 34192:HEAP32[r>>2]=n.colorOp[0];return;case 34193:HEAP32[r>>2]=n.colorOp[1];return;case 34194:HEAP32[r>>2]=n.colorOp[2];return;case 34200:HEAP32[r>>2]=n.alphaOp[0];return;case 34201:HEAP32[r>>2]=n.alphaOp[1];return;case 34202:HEAP32[r>>2]=n.alphaOp[2];return;case 34163:HEAP32[r>>2]=n.colorScale;return;case 3356:HEAP32[r>>2]=n.alphaScale;return;default:err("WARNING: Unhandled `pname` in call to `glGetTexEnvi`.")}}},hook_getTexEnvfv:function(e,t,r){if(8960==e){var n=d().env;if(8705===t){HEAPF32[r>>2]=n.envColor[0],HEAPF32[r+4>>2]=n.envColor[1],HEAPF32[r+8>>2]=n.envColor[2],HEAPF32[r+12>>2]=n.envColor[3];return}}}}},vertexData:null,vertexDataU8:null,tempData:null,indexData:null,vertexCounter:0,mode:-1,rendererCache:null,rendererComponents:[],rendererComponentPointer:0,lastRenderer:null,lastArrayBuffer:null,lastProgram:null,lastStride:-1,matrix:[],matrixStack:[],currentMatrix:0,tempMatrix:null,matricesModified:!1,useTextureMatrix:!1,VERTEX:0,NORMAL:1,COLOR:2,TEXTURE0:3,NUM_ATTRIBUTES:-1,MAX_TEXTURES:-1,totalEnabledClientAttributes:0,enabledClientAttributes:[0,0],clientAttributes:[],liveClientAttributes:[],currentRenderer:null,modifiedClientAttributes:!1,clientActiveTexture:0,clientColor:null,usedTexUnitList:[],fixedFunctionProgram:null,setClientAttribute:function e(t,r,n,o,i){var a=GLImmediate.clientAttributes[t];if(a)a.name=t,a.size=r,a.type=n,a.stride=o,a.pointer=i,a.offset=0;else for(var s=0;s<=t;s++)GLImmediate.clientAttributes[s]||(GLImmediate.clientAttributes[s]={name:t,size:r,type:n,stride:o,pointer:i,offset:0});GLImmediate.modifiedClientAttributes=!0},addRendererComponent:function e(t,r,n){GLImmediate.rendererComponents[t]?GLImmediate.rendererComponents[t]++:(GLImmediate.rendererComponents[t]=1,GLImmediate.enabledClientAttributes[t]=!0,GLImmediate.setClientAttribute(t,r,n,0,GLImmediate.rendererComponentPointer),GLImmediate.rendererComponentPointer+=r*GL.byteSizeByType[n-GL.byteSizeByTypeRoot],GL.enableVertexAttribArray(t))},disableBeginEndClientAttributes:function e(){for(var t=0;t<GLImmediate.NUM_ATTRIBUTES;t++)GLImmediate.rendererComponents[t]&&(GLImmediate.enabledClientAttributes[t]=!1)},getRenderer:function e(){if(GLImmediate.currentRenderer)return GLImmediate.currentRenderer;for(var t=GLImmediate.liveClientAttributes,r=GLImmediate.rendererCache.getStaticKeyView().reset(),n=0,o=0;o<t.length;o++)n|=1<<t[o].name;r.next(n),n=0;var i=0;if(GLEmulation.fogEnabled)switch(GLEmulation.fogMode){case 2049:i=1;break;case 9729:i=2;break;default:i=3}n=n<<2|i;for(var a=0;a<GLEmulation.MAX_CLIP_PLANES;a++)n=n<<1|GLEmulation.clipPlaneEnabled[a];n=n<<1|GLEmulation.lightingEnabled;for(var s=0;s<GLEmulation.MAX_LIGHTS;s++)n=n<<1|(GLEmulation.lightingEnabled?GLEmulation.lightEnabled[s]:0);n=(n=n<<3|(GLEmulation.alphaTestEnabled?GLEmulation.alphaTestFunc-512:7))<<1|(GLImmediate.mode==GLctx.POINTS?1:0),r.next(n),GLImmediate.TexEnvJIT.traverseState(r);var u=r.get();return u?(GLImmediate.currentRenderer=u,u):(u=GLImmediate.createRenderer(),GLImmediate.currentRenderer=u,r.set(u),u)},createRenderer:function e(t){for(var r=!!GL.currProgram,n=!1,o=0;o<GLImmediate.MAX_TEXTURES;o++){var i=GLImmediate.TEXTURE0+o;GLImmediate.enabledClientAttributes[i]&&(n=!0)}var a={init:function e(){var t="u_texUnit",o="a_texCoord",i="v_texCoord",a=GLImmediate.useTextureMatrix?"u_textureMatrix":null;if(r)GL.shaderInfos[GL.programShaders[GL.currProgram][0]].type==GLctx.VERTEX_SHADER?(this.vertexShader=GL.shaders[GL.programShaders[GL.currProgram][0]],this.fragmentShader=GL.shaders[GL.programShaders[GL.currProgram][1]]):(this.vertexShader=GL.shaders[GL.programShaders[GL.currProgram][1]],this.fragmentShader=GL.shaders[GL.programShaders[GL.currProgram][0]]),this.program=GL.programs[GL.currProgram],this.usedTexUnitList=[];else{if(GLEmulation.fogEnabled)switch(GLEmulation.fogMode){case 2049:var s="  float fog = exp(-u_fogDensity * u_fogDensity * ecDistance * ecDistance); \n";break;case 9729:var s="  float fog = (u_fogEnd - ecDistance) * u_fogScale; \n";break;default:var s="  float fog = exp(-u_fogDensity * ecDistance); \n"}GLImmediate.TexEnvJIT.setGLSLVars(t,i,"v_color",a);var u=GLImmediate.TexEnvJIT.genAllPassLines("gl_FragColor",2),l="",c="",m="",d="";this.usedTexUnitList=GLImmediate.TexEnvJIT.getUsedTexUnitList();for(var f=0;f<this.usedTexUnitList.length;f++){var p=this.usedTexUnitList[f];l+="attribute vec4 "+o+p+";\n",c+="varying vec4 "+i+p+";\n",m+="uniform sampler2D "+t+p+";\n",d+="  "+i+p+" = "+o+p+";\n",GLImmediate.useTextureMatrix&&(m+="uniform mat4 "+a+p+";\n")}var h=null;GLEmulation.fogEnabled&&(h="  v_fogFragCoord = abs(ecPosition.z);\n");var L=null,g=null;GLImmediate.mode==GLctx.POINTS&&(L="uniform float u_pointSize;\n",g="  gl_PointSize = u_pointSize;\n");for(var $="",_="",v="",E="",G=0;G<GLEmulation.MAX_CLIP_PLANES;G++)GLEmulation.clipPlaneEnabled[G]&&($+="uniform vec4 u_clipPlaneEquation"+G+";",$+="varying float v_clipDistance"+G+";",_+="  v_clipDistance"+G+" = dot(ecPosition, u_clipPlaneEquation"+G+");",v+="varying float v_clipDistance"+G+";",E+="  if(v_clipDistance"+G+" < 0.0) discard;");var S="",x="";if(GLEmulation.lightingEnabled){S+="attribute vec3 a_normal;",S+="uniform mat3 u_normalMatrix;",S+="uniform vec4 u_lightModelAmbient;",S+="uniform vec4 u_materialAmbient;",S+="uniform vec4 u_materialDiffuse;",S+="uniform vec4 u_materialSpecular;",S+="uniform float u_materialShininess;",S+="uniform vec4 u_materialEmission;",x+="  vec3 ecNormal = normalize(u_normalMatrix * a_normal);",x+="  v_color.w = u_materialDiffuse.w;",x+="  v_color.xyz = u_materialEmission.xyz;",x+="  v_color.xyz += u_lightModelAmbient.xyz * u_materialAmbient.xyz;";for(var w=0;w<GLEmulation.MAX_LIGHTS;w++)GLEmulation.lightEnabled[w]&&(S+="uniform vec4 u_lightAmbient"+w+";",S+="uniform vec4 u_lightDiffuse"+w+";",S+="uniform vec4 u_lightSpecular"+w+";",S+="uniform vec4 u_lightPosition"+w+";",x+="  {",x+="    vec3 lightDirection = normalize(u_lightPosition"+w+").xyz;",x+="    vec3 halfVector = normalize(lightDirection + vec3(0,0,1));",x+="    vec3 ambient = u_lightAmbient"+w+".xyz * u_materialAmbient.xyz;",x+="    float diffuseI = max(dot(ecNormal, lightDirection), 0.0);",x+="    float specularI = max(dot(ecNormal, halfVector), 0.0);",x+="    vec3 diffuse = diffuseI * u_lightDiffuse"+w+".xyz * u_materialDiffuse.xyz;",x+="    specularI = (diffuseI > 0.0 && specularI > 0.0) ? exp(u_materialShininess * log(specularI)) : 0.0;",x+="    vec3 specular = specularI * u_lightSpecular"+w+".xyz * u_materialSpecular.xyz;",x+="    v_color.xyz += ambient + diffuse + specular;",x+="  }");x+="  v_color = clamp(v_color, 0.0, 1.0);"}var b=["attribute vec4 a_position;","attribute vec4 a_color;","varying vec4 v_color;",l,c,GLEmulation.fogEnabled?"varying float v_fogFragCoord;":null,"uniform mat4 u_modelView;","uniform mat4 u_projection;",L,$,S,"void main()","{","  vec4 ecPosition = u_modelView * a_position;","  gl_Position = u_projection * ecPosition;","  v_color = a_color;",d,h,g,_,x,"}",""].join("\n").replace(/\n\n+/g,"\n");this.vertexShader=GLctx.createShader(GLctx.VERTEX_SHADER),GLctx.shaderSource(this.vertexShader,b),GLctx.compileShader(this.vertexShader);var F=null;GLEmulation.fogEnabled&&(F=["","varying float v_fogFragCoord; ","uniform vec4 u_fogColor;      ","uniform float u_fogEnd;       ","uniform float u_fogScale;     ","uniform float u_fogDensity;   ","float ffog(in float ecDistance) { ",s,"  fog = clamp(fog, 0.0, 1.0); ","  return fog;                 ","}",""].join("\n"));var y=null;GLEmulation.fogEnabled&&(y="gl_FragColor = vec4(mix(u_fogColor.rgb, gl_FragColor.rgb, ffog(v_fogFragCoord)), gl_FragColor.a);\n");var A="",T="";if(GLEmulation.alphaTestEnabled)switch(A="uniform float u_alphaTestRef;",GLEmulation.alphaTestFunc){case 512:T="discard;";break;case 513:T="if( !(gl_FragColor.a < u_alphaTestRef) ) { discard; }";break;case 514:T="if( !(gl_FragColor.a == u_alphaTestRef) ) { discard; }";break;case 515:T="if( !(gl_FragColor.a <= u_alphaTestRef) ) { discard; }";break;case 516:T="if( !(gl_FragColor.a > u_alphaTestRef) ) { discard; }";break;case 517:T="if( !(gl_FragColor.a != u_alphaTestRef) ) { discard; }";break;case 518:T="if( !(gl_FragColor.a >= u_alphaTestRef) ) { discard; }";break;case 519:T=""}var M=["precision mediump float;",c,m,"varying vec4 v_color;",F,v,A,"void main()","{",E,u,y,T,"}",""].join("\n").replace(/\n\n+/g,"\n");this.fragmentShader=GLctx.createShader(GLctx.FRAGMENT_SHADER),GLctx.shaderSource(this.fragmentShader,M),GLctx.compileShader(this.fragmentShader),this.program=GLctx.createProgram(),GLctx.attachShader(this.program,this.vertexShader),GLctx.attachShader(this.program,this.fragmentShader),GLctx.bindAttribLocation(this.program,GLImmediate.VERTEX,"a_position"),GLctx.bindAttribLocation(this.program,GLImmediate.COLOR,"a_color"),GLctx.bindAttribLocation(this.program,GLImmediate.NORMAL,"a_normal");for(var I=GLctx.getParameter(GLctx.MAX_VERTEX_ATTRIBS),f=0;f<GLImmediate.MAX_TEXTURES&&GLImmediate.TEXTURE0+f<I;f++)GLctx.bindAttribLocation(this.program,GLImmediate.TEXTURE0+f,"a_texCoord"+f),GLctx.bindAttribLocation(this.program,GLImmediate.TEXTURE0+f,o+f);GLctx.linkProgram(this.program)}this.textureMatrixVersion=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.positionLocation=GLctx.getAttribLocation(this.program,"a_position"),this.texCoordLocations=[];for(var f=0;f<GLImmediate.MAX_TEXTURES;f++){if(!GLImmediate.enabledClientAttributes[GLImmediate.TEXTURE0+f]){this.texCoordLocations[f]=-1;continue}r?this.texCoordLocations[f]=GLctx.getAttribLocation(this.program,"a_texCoord"+f):this.texCoordLocations[f]=GLctx.getAttribLocation(this.program,o+f)}if(this.colorLocation=GLctx.getAttribLocation(this.program,"a_color"),!r){var P=GLctx.getParameter(GLctx.CURRENT_PROGRAM);GLctx.useProgram(this.program);for(var f=0;f<this.usedTexUnitList.length;f++){var B=this.usedTexUnitList[f],k=GLctx.getUniformLocation(this.program,t+B);GLctx.uniform1i(k,B)}GLctx.vertexAttrib4fv(this.colorLocation,[1,1,1,1]),GLctx.useProgram(P)}this.textureMatrixLocations=[];for(var f=0;f<GLImmediate.MAX_TEXTURES;f++)this.textureMatrixLocations[f]=GLctx.getUniformLocation(this.program,"u_textureMatrix"+f);this.normalLocation=GLctx.getAttribLocation(this.program,"a_normal"),this.modelViewLocation=GLctx.getUniformLocation(this.program,"u_modelView"),this.projectionLocation=GLctx.getUniformLocation(this.program,"u_projection"),this.normalMatrixLocation=GLctx.getUniformLocation(this.program,"u_normalMatrix"),this.hasTextures=n,this.hasNormal=GLImmediate.enabledClientAttributes[GLImmediate.NORMAL]&&GLImmediate.clientAttributes[GLImmediate.NORMAL].size>0&&this.normalLocation>=0,this.hasColor=0===this.colorLocation||this.colorLocation>0,this.floatType=GLctx.FLOAT,this.fogColorLocation=GLctx.getUniformLocation(this.program,"u_fogColor"),this.fogEndLocation=GLctx.getUniformLocation(this.program,"u_fogEnd"),this.fogScaleLocation=GLctx.getUniformLocation(this.program,"u_fogScale"),this.fogDensityLocation=GLctx.getUniformLocation(this.program,"u_fogDensity"),this.hasFog=!!(this.fogColorLocation||this.fogEndLocation||this.fogScaleLocation||this.fogDensityLocation),this.pointSizeLocation=GLctx.getUniformLocation(this.program,"u_pointSize"),this.hasClipPlane=!1,this.clipPlaneEquationLocation=[];for(var G=0;G<GLEmulation.MAX_CLIP_PLANES;G++)this.clipPlaneEquationLocation[G]=GLctx.getUniformLocation(this.program,"u_clipPlaneEquation"+G),this.hasClipPlane=this.hasClipPlane||this.clipPlaneEquationLocation[G];this.hasLighting=GLEmulation.lightingEnabled,this.lightModelAmbientLocation=GLctx.getUniformLocation(this.program,"u_lightModelAmbient"),this.materialAmbientLocation=GLctx.getUniformLocation(this.program,"u_materialAmbient"),this.materialDiffuseLocation=GLctx.getUniformLocation(this.program,"u_materialDiffuse"),this.materialSpecularLocation=GLctx.getUniformLocation(this.program,"u_materialSpecular"),this.materialShininessLocation=GLctx.getUniformLocation(this.program,"u_materialShininess"),this.materialEmissionLocation=GLctx.getUniformLocation(this.program,"u_materialEmission"),this.lightAmbientLocation=[],this.lightDiffuseLocation=[],this.lightSpecularLocation=[],this.lightPositionLocation=[];for(var w=0;w<GLEmulation.MAX_LIGHTS;w++)this.lightAmbientLocation[w]=GLctx.getUniformLocation(this.program,"u_lightAmbient"+w),this.lightDiffuseLocation[w]=GLctx.getUniformLocation(this.program,"u_lightDiffuse"+w),this.lightSpecularLocation[w]=GLctx.getUniformLocation(this.program,"u_lightSpecular"+w),this.lightPositionLocation[w]=GLctx.getUniformLocation(this.program,"u_lightPosition"+w);this.hasAlphaTest=GLEmulation.alphaTestEnabled,this.alphaTestRefLocation=GLctx.getUniformLocation(this.program,"u_alphaTestRef")},prepare:function e(){if(GLctx.currentArrayBufferBinding)t=GLctx.currentArrayBufferBinding;else{var t,r=GLImmediate.firstVertex*GLImmediate.stride,n=GLImmediate.lastVertex*GLImmediate.stride;t=GL.getTempVertexBuffer(n)}var o=GLImmediate.lastRenderer,i=this==o&&t==GLImmediate.lastArrayBuffer&&(GL.currProgram||this.program)==GLImmediate.lastProgram&&GLImmediate.stride==GLImmediate.lastStride&&!GLImmediate.matricesModified;if(!i&&o&&o.cleanup(),GLctx.currentArrayBufferBinding||(t!=GLImmediate.lastArrayBuffer&&(GLctx.bindBuffer(GLctx.ARRAY_BUFFER,t),GLImmediate.lastArrayBuffer=t),GLctx.bufferSubData(GLctx.ARRAY_BUFFER,r,GLImmediate.vertexData.subarray(r>>2,n>>2))),!i){if(GLImmediate.lastRenderer=this,GLImmediate.lastProgram=GL.currProgram||this.program,GLImmediate.lastStride,GLImmediate.stride,GLImmediate.matricesModified=!1,GL.currProgram||GLImmediate.fixedFunctionProgram==this.program||(GLctx.useProgram(this.program),GLImmediate.fixedFunctionProgram=this.program),this.modelViewLocation&&this.modelViewMatrixVersion!=GLImmediate.matrixVersion[0]&&(this.modelViewMatrixVersion=GLImmediate.matrixVersion[0],GLctx.uniformMatrix4fv(this.modelViewLocation,!1,GLImmediate.matrix[0]),GLEmulation.lightEnabled)){var a=GLImmediate.matrixLib.mat4.create(GLImmediate.matrix[0]);GLImmediate.matrixLib.mat4.inverse(a),GLImmediate.matrixLib.mat4.transpose(a),GLctx.uniformMatrix3fv(this.normalMatrixLocation,!1,GLImmediate.matrixLib.mat4.toMat3(a))}this.projectionLocation&&this.projectionMatrixVersion!=GLImmediate.matrixVersion[1]&&(this.projectionMatrixVersion=GLImmediate.matrixVersion[1],GLctx.uniformMatrix4fv(this.projectionLocation,!1,GLImmediate.matrix[1]));var s=GLImmediate.clientAttributes,u=s[GLImmediate.VERTEX];if(!GLctx.currentArrayBufferBinding&&(GLctx.vertexAttribPointer(GLImmediate.VERTEX,u.size,u.type,!1,GLImmediate.stride,u.offset),this.hasNormal)){var l=s[GLImmediate.NORMAL];GLctx.vertexAttribPointer(GLImmediate.NORMAL,l.size,l.type,!0,GLImmediate.stride,l.offset)}if(this.hasTextures)for(var c=0;c<GLImmediate.MAX_TEXTURES;c++){if(!GLctx.currentArrayBufferBinding){var m=GLImmediate.TEXTURE0+c,d=s[m];d.size?GLctx.vertexAttribPointer(m,d.size,d.type,!1,GLImmediate.stride,d.offset):GLctx.vertexAttrib4f(m,0,0,0,1)}var f=2+c;this.textureMatrixLocations[c]&&this.textureMatrixVersion[f]!=GLImmediate.matrixVersion[f]&&(this.textureMatrixVersion[f]=GLImmediate.matrixVersion[f],GLctx.uniformMatrix4fv(this.textureMatrixLocations[c],!1,GLImmediate.matrix[f]))}if(GLImmediate.enabledClientAttributes[GLImmediate.COLOR]){var p=s[GLImmediate.COLOR];GLctx.currentArrayBufferBinding||GLctx.vertexAttribPointer(GLImmediate.COLOR,p.size,p.type,!0,GLImmediate.stride,p.offset)}if(this.hasFog&&(this.fogColorLocation&&GLctx.uniform4fv(this.fogColorLocation,GLEmulation.fogColor),this.fogEndLocation&&GLctx.uniform1f(this.fogEndLocation,GLEmulation.fogEnd),this.fogScaleLocation&&GLctx.uniform1f(this.fogScaleLocation,1/(GLEmulation.fogEnd-GLEmulation.fogStart)),this.fogDensityLocation&&GLctx.uniform1f(this.fogDensityLocation,GLEmulation.fogDensity)),this.hasClipPlane)for(var h=0;h<GLEmulation.MAX_CLIP_PLANES;h++)this.clipPlaneEquationLocation[h]&&GLctx.uniform4fv(this.clipPlaneEquationLocation[h],GLEmulation.clipPlaneEquation[h]);if(this.hasLighting){this.lightModelAmbientLocation&&GLctx.uniform4fv(this.lightModelAmbientLocation,GLEmulation.lightModelAmbient),this.materialAmbientLocation&&GLctx.uniform4fv(this.materialAmbientLocation,GLEmulation.materialAmbient),this.materialDiffuseLocation&&GLctx.uniform4fv(this.materialDiffuseLocation,GLEmulation.materialDiffuse),this.materialSpecularLocation&&GLctx.uniform4fv(this.materialSpecularLocation,GLEmulation.materialSpecular),this.materialShininessLocation&&GLctx.uniform1f(this.materialShininessLocation,GLEmulation.materialShininess[0]),this.materialEmissionLocation&&GLctx.uniform4fv(this.materialEmissionLocation,GLEmulation.materialEmission);for(var L=0;L<GLEmulation.MAX_LIGHTS;L++)this.lightAmbientLocation[L]&&GLctx.uniform4fv(this.lightAmbientLocation[L],GLEmulation.lightAmbient[L]),this.lightDiffuseLocation[L]&&GLctx.uniform4fv(this.lightDiffuseLocation[L],GLEmulation.lightDiffuse[L]),this.lightSpecularLocation[L]&&GLctx.uniform4fv(this.lightSpecularLocation[L],GLEmulation.lightSpecular[L]),this.lightPositionLocation[L]&&GLctx.uniform4fv(this.lightPositionLocation[L],GLEmulation.lightPosition[L])}this.hasAlphaTest&&this.alphaTestRefLocation&&GLctx.uniform1f(this.alphaTestRefLocation,GLEmulation.alphaTestRef),GLImmediate.mode==GLctx.POINTS&&this.pointSizeLocation&&GLctx.uniform1f(this.pointSizeLocation,GLEmulation.pointSize)}},cleanup:function e(){}};return a.init(),a},setupFuncs:function(){GLImmediate.MapTreeLib=GLImmediate.spawnMapTreeLib(),GLImmediate.spawnMapTreeLib=null,GLImmediate.TexEnvJIT=GLImmediate.spawnTexEnvJIT(),GLImmediate.spawnTexEnvJIT=null,GLImmediate.setupHooks()},setupHooks:function(){GLEmulation.hasRunInit||GLEmulation.init();var e=_glActiveTexture;_glActiveTexture=_emscripten_glActiveTexture=function t(r){GLImmediate.TexEnvJIT.hook_activeTexture(r),e(r)};var t=_glEnable;_glEnable=_emscripten_glEnable=function e(r){GLImmediate.TexEnvJIT.hook_enable(r),t(r)};var r=_glDisable;_glDisable=_emscripten_glDisable=function e(t){GLImmediate.TexEnvJIT.hook_disable(t),r(t)},_glTexEnvf=_emscripten_glTexEnvf=function e(t,r,n){GLImmediate.TexEnvJIT.hook_texEnvf(t,r,n)},_glTexEnvi=_emscripten_glTexEnvi=function e(t,r,n){GLImmediate.TexEnvJIT.hook_texEnvi(t,r,n)},_glTexEnvfv=_emscripten_glTexEnvfv=function e(t,r,n){GLImmediate.TexEnvJIT.hook_texEnvfv(t,r,n)},_glGetTexEnviv=function e(t,r,n){GLImmediate.TexEnvJIT.hook_getTexEnviv(t,r,n)},_glGetTexEnvfv=function e(t,r,n){GLImmediate.TexEnvJIT.hook_getTexEnvfv(t,r,n)};var n=_glGetIntegerv;_glGetIntegerv=_emscripten_glGetIntegerv=function e(t,r){if(35725===t&&GLctx.getParameter(GLctx.CURRENT_PROGRAM)==GLImmediate.fixedFunctionProgram){HEAP32[r>>2]=0;return}n(t,r)}},initted:!1,init:function(){if(err("WARNING: using emscripten GL immediate mode emulation. This is very limited in what it supports"),GLImmediate.initted=!0,Module.useWebGL){GLImmediate.MAX_TEXTURES=Math.max(Module.GL_MAX_TEXTURE_IMAGE_UNITS||GLctx.getParameter(GLctx.MAX_TEXTURE_IMAGE_UNITS),28),GLImmediate.TexEnvJIT.init(GLctx,GLImmediate.MAX_TEXTURES),GLImmediate.NUM_ATTRIBUTES=3+GLImmediate.MAX_TEXTURES,GLImmediate.clientAttributes=[],GLEmulation.enabledClientAttribIndices=[];for(var e=0;e<GLImmediate.NUM_ATTRIBUTES;e++)GLImmediate.clientAttributes.push({}),GLEmulation.enabledClientAttribIndices.push(!1);GLImmediate.matrix=[],GLImmediate.matrixStack=[],GLImmediate.matrixVersion=[];for(var e=0;e<2+GLImmediate.MAX_TEXTURES;e++)GLImmediate.matrixStack.push([]),GLImmediate.matrixVersion.push(0),GLImmediate.matrix.push(GLImmediate.matrixLib.mat4.create()),GLImmediate.matrixLib.mat4.identity(GLImmediate.matrix[e]);GLImmediate.rendererCache=GLImmediate.MapTreeLib.create(),GLImmediate.tempData=new Float32Array(GL.MAX_TEMP_BUFFER_SIZE>>2),GLImmediate.indexData=new Uint16Array(GL.MAX_TEMP_BUFFER_SIZE>>1),GLImmediate.vertexDataU8=new Uint8Array(GLImmediate.tempData.buffer),GL.generateTempBuffers(!0,GL.currentContext),GLImmediate.clientColor=new Float32Array([1,1,1,1])}},prepareClientAttributes:function e(t,r){if(!GLImmediate.modifiedClientAttributes){GLImmediate.vertexCounter=GLImmediate.stride*t/4;return}GLImmediate.modifiedClientAttributes=!1;var n=2147483647,o=0,i=2147483647,a=0,s=GLImmediate.liveClientAttributes;s.length=0;for(var u=0;u<3+GLImmediate.MAX_TEXTURES;u++)if(GLImmediate.enabledClientAttributes[u]){var l=GLImmediate.clientAttributes[u];s.push(l),n=Math.min(n,l.pointer),l.sizeBytes=l.size*GL.byteSizeByType[l.type-GL.byteSizeByTypeRoot],o+=l.sizeBytes,i=Math.min(i,l.stride),a=Math.max(a,l.stride)}if((i!=a||a<o)&&!r){GLImmediate.restrideBuffer||(GLImmediate.restrideBuffer=_malloc(GL.MAX_TEMP_BUFFER_SIZE));var c=GLImmediate.restrideBuffer;o=0;for(var u=0;u<s.length;u++){var l=s[u],m=l.sizeBytes;m%4!=0&&(m+=4-m%4),l.offset=o,o+=m}for(var u=0;u<s.length;u++){var l=s[u],d=Math.max(l.sizeBytes,l.stride);if((3&d)==0&&(3&l.sizeBytes)==0)for(var f=l.sizeBytes>>2,p=Math.max(l.sizeBytes,l.stride)>>2,h=0;h<t;h++)for(var L=0;L<f;L++)HEAP32[(c+l.offset+o*h>>2)+L]=HEAP32[(l.pointer>>2)+h*p+L];else for(var h=0;h<t;h++)for(var L=0;L<l.sizeBytes;L++)HEAP8[c+l.offset+o*h+L]=HEAP8[l.pointer+h*d+L];l.pointer=c+l.offset}GLImmediate.stride=o,GLImmediate.vertexPointer=c}else{GLctx.currentArrayBufferBinding?GLImmediate.vertexPointer=0:GLImmediate.vertexPointer=n;for(var u=0;u<s.length;u++){var l=s[u];l.offset=l.pointer-GLImmediate.vertexPointer}GLImmediate.stride=Math.max(a,o)}r||(GLImmediate.vertexCounter=GLImmediate.stride*t/4)},flush:function e(t,r,n){r=r||0,n=n||0;var o=GLImmediate.getRenderer(),i=4*GLImmediate.vertexCounter/GLImmediate.stride;if(i){var a=!1,s=0;if(t){if(s=t,!GLctx.currentArrayBufferBinding&&GLImmediate.firstVertex>GLImmediate.lastVertex)for(var u=0;u<t;u++){var l=HEAPU16[n+2*u>>1];GLImmediate.firstVertex=Math.min(GLImmediate.firstVertex,l),GLImmediate.lastVertex=Math.max(GLImmediate.lastVertex,l+1)}if(!GLctx.currentElementArrayBufferBinding){var c=GL.getTempIndexBuffer(t<<1);GLctx.bindBuffer(GLctx.ELEMENT_ARRAY_BUFFER,c),GLctx.bufferSubData(GLctx.ELEMENT_ARRAY_BUFFER,0,HEAPU16.subarray(n>>1,n+(t<<1)>>1)),n=0,a=!0}}else if(GLImmediate.mode>6){if(7!=GLImmediate.mode)throw"unsupported immediate mode "+GLImmediate.mode;n=3*GLImmediate.firstVertex,s=6*(i/4),GLctx.bindBuffer(GLctx.ELEMENT_ARRAY_BUFFER,GL.currentContext.tempQuadIndexBuffer),a=!0,GLImmediate.mode=GLctx.TRIANGLES}o.prepare(),s?GLctx.drawElements(GLImmediate.mode,s,GLctx.UNSIGNED_SHORT,n):GLctx.drawArrays(GLImmediate.mode,r,i),a&&GLctx.bindBuffer(GLctx.ELEMENT_ARRAY_BUFFER,GL.buffers[GLctx.currentElementArrayBufferBinding]||null)}}};function _glBegin(e){GLImmediate.enabledClientAttributes_preBegin=GLImmediate.enabledClientAttributes,GLImmediate.enabledClientAttributes=[],GLImmediate.clientAttributes_preBegin=GLImmediate.clientAttributes,GLImmediate.clientAttributes=[];for(var t=0;t<GLImmediate.clientAttributes_preBegin.length;t++)GLImmediate.clientAttributes.push({});GLImmediate.mode=e,GLImmediate.vertexCounter=0;for(var r=GLImmediate.rendererComponents=[],t=0;t<GLImmediate.NUM_ATTRIBUTES;t++)r[t]=0;GLImmediate.rendererComponentPointer=0,GLImmediate.vertexData=GLImmediate.tempData}function _glClear(e){GLctx.clear(e)}function _glClearColor(e,t,r,n){GLctx.clearColor(e,t,r,n)}function _glClearDepth(e){GLctx.clearDepth(e)}function _emscripten_glColor4f(e,t,r,n){if(e=Math.max(Math.min(e,1),0),t=Math.max(Math.min(t,1),0),r=Math.max(Math.min(r,1),0),n=Math.max(Math.min(n,1),0),GLImmediate.mode>=0){var o=GLImmediate.vertexCounter<<2;GLImmediate.vertexDataU8[o+0]=255*e,GLImmediate.vertexDataU8[o+1]=255*t,GLImmediate.vertexDataU8[o+2]=255*r,GLImmediate.vertexDataU8[o+3]=255*n,GLImmediate.vertexCounter++,GLImmediate.addRendererComponent(GLImmediate.COLOR,4,GLctx.UNSIGNED_BYTE)}else GLImmediate.clientColor[0]=e,GLImmediate.clientColor[1]=t,GLImmediate.clientColor[2]=r,GLImmediate.clientColor[3]=n,GLctx.vertexAttrib4fv(GLImmediate.COLOR,GLImmediate.clientColor)}function _glColor3d(e,t,r){_emscripten_glColor4f(e,t,r,1)}function _glColor3f(e,t,r){_emscripten_glColor4f(e,t,r,1)}function _glEnd(){GLImmediate.prepareClientAttributes(GLImmediate.rendererComponents[GLImmediate.VERTEX],!0),GLImmediate.firstVertex=0,GLImmediate.lastVertex=GLImmediate.vertexCounter/(GLImmediate.stride>>2),GLImmediate.flush(),GLImmediate.disableBeginEndClientAttributes(),GLImmediate.mode=-1,GLImmediate.enabledClientAttributes=GLImmediate.enabledClientAttributes_preBegin,GLImmediate.clientAttributes=GLImmediate.clientAttributes_preBegin,GLImmediate.currentRenderer=null,GLImmediate.modifiedClientAttributes=!0}function _glLineWidth(e){GLctx.lineWidth(e)}function _glLoadIdentity(){GLImmediate.matricesModified=!0,GLImmediate.matrixVersion[GLImmediate.currentMatrix]=GLImmediate.matrixVersion[GLImmediate.currentMatrix]+1|0,GLImmediate.matrixLib.mat4.identity(GLImmediate.matrix[GLImmediate.currentMatrix])}function _glMatrixMode(e){if(5888==e)GLImmediate.currentMatrix=0;else if(5889==e)GLImmediate.currentMatrix=1;else if(5890==e)GLImmediate.useTextureMatrix=!0,GLImmediate.currentMatrix=2+GLImmediate.TexEnvJIT.getActiveTexture();else throw"Wrong mode "+e+" passed to glMatrixMode"}function _glOrtho(e,t,r,n,o,i){GLImmediate.matricesModified=!0,GLImmediate.matrixVersion[GLImmediate.currentMatrix]=GLImmediate.matrixVersion[GLImmediate.currentMatrix]+1|0,GLImmediate.matrixLib.mat4.multiply(GLImmediate.matrix[GLImmediate.currentMatrix],GLImmediate.matrixLib.mat4.ortho(e,t,r,n,o,i))}function _glPixelStorei(e,t){3317==e&&(GL.unpackAlignment=t),GLctx.pixelStorei(e,t)}function _glPointSize(e){GLEmulation.pointSize=e}function _glPopMatrix(){if(0==GLImmediate.matrixStack[GLImmediate.currentMatrix].length){GL.recordError(1284);return}GLImmediate.matricesModified=!0,GLImmediate.matrixVersion[GLImmediate.currentMatrix]=GLImmediate.matrixVersion[GLImmediate.currentMatrix]+1|0,GLImmediate.matrix[GLImmediate.currentMatrix]=GLImmediate.matrixStack[GLImmediate.currentMatrix].pop()}function _glPushMatrix(){GLImmediate.matricesModified=!0,GLImmediate.matrixVersion[GLImmediate.currentMatrix]=GLImmediate.matrixVersion[GLImmediate.currentMatrix]+1|0,GLImmediate.matrixStack[GLImmediate.currentMatrix].push(Array.prototype.slice.call(GLImmediate.matrix[GLImmediate.currentMatrix]))}function _glScaled(e,t,r){GLImmediate.matricesModified=!0,GLImmediate.matrixVersion[GLImmediate.currentMatrix]=GLImmediate.matrixVersion[GLImmediate.currentMatrix]+1|0,GLImmediate.matrixLib.mat4.scale(GLImmediate.matrix[GLImmediate.currentMatrix],[e,t,r])}function _emscripten_glVertex2f(e,t){GLImmediate.vertexData[GLImmediate.vertexCounter++]=e,GLImmediate.vertexData[GLImmediate.vertexCounter++]=t,GLImmediate.vertexData[GLImmediate.vertexCounter++]=0,GLImmediate.vertexData[GLImmediate.vertexCounter++]=1,GLImmediate.addRendererComponent(GLImmediate.VERTEX,4,GLctx.FLOAT)}function _glVertex2fv(e){_emscripten_glVertex2f(HEAPF32[e>>2],HEAPF32[e+4>>2])}function _glVertex2i(e,t){GLImmediate.vertexData[GLImmediate.vertexCounter++]=e,GLImmediate.vertexData[GLImmediate.vertexCounter++]=t,GLImmediate.vertexData[GLImmediate.vertexCounter++]=0,GLImmediate.vertexData[GLImmediate.vertexCounter++]=1,GLImmediate.addRendererComponent(GLImmediate.VERTEX,4,GLctx.FLOAT)}function _glViewport(e,t,r,n){GLctx.viewport(e,t,r,n)}function _emscripten_glOrtho(e,t,r,n,o,i){GLImmediate.matricesModified=!0,GLImmediate.matrixVersion[GLImmediate.currentMatrix]=GLImmediate.matrixVersion[GLImmediate.currentMatrix]+1|0,GLImmediate.matrixLib.mat4.multiply(GLImmediate.matrix[GLImmediate.currentMatrix],GLImmediate.matrixLib.mat4.ortho(e,t,r,n,o,i))}function _gluOrtho2D(e,t,r,n){_emscripten_glOrtho(e,t,r,n,-1,1)}function _glutPostRedisplay(){GLUT.displayFunc&&!GLUT.requestedAnimationFrame&&(GLUT.requestedAnimationFrame=!0,Browser.requestAnimationFrame(function(){GLUT.requestedAnimationFrame=!1,Browser.mainLoop.runIter(function(){getWasmTableEntry(GLUT.displayFunc)()})}))}GLImmediate.matrixLib=function(){var e={},t={},r={},n={},o=Float32Array;return e.create=function(e){var t=new o(3);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):t[0]=t[1]=t[2]=0,t},e.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.add=function(e,t,r){return r&&e!==r?(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e)},e.subtract=function(e,t,r){return r&&e!==r?(r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r):(e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e)},e.multiply=function(e,t,r){return r&&e!==r?(r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r):(e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],e)},e.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},e.scale=function(e,t,r){return r&&e!==r?(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r):(e[0]*=t,e[1]*=t,e[2]*=t,e)},e.normalize=function(e,t){t||(t=e);var r=e[0],n=e[1],o=e[2],i=Math.sqrt(r*r+n*n+o*o);return i?1===i?(t[0]=r,t[1]=n,t[2]=o,t):(i=1/i,t[0]=r*i,t[1]=n*i,t[2]=o*i,t):(t[0]=0,t[1]=0,t[2]=0,t)},e.cross=function(e,t,r){r||(r=e);var n=e[0],o=e[1],i=e[2],a=t[0],s=t[1],u=t[2];return r[0]=o*u-i*s,r[1]=i*a-n*u,r[2]=n*s-o*a,r},e.length=function(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.direction=function(e,t,r){r||(r=e);var n=e[0]-t[0],o=e[1]-t[1],i=e[2]-t[2],a=Math.sqrt(n*n+o*o+i*i);return a?(a=1/a,r[0]=n*a,r[1]=o*a,r[2]=i*a,r):(r[0]=0,r[1]=0,r[2]=0,r)},e.lerp=function(e,t,r,n){return n||(n=e),n[0]=e[0]+r*(t[0]-e[0]),n[1]=e[1]+r*(t[1]-e[1]),n[2]=e[2]+r*(t[2]-e[2]),n},e.dist=function(e,t){var r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(r*r+n*n+o*o)},e.unproject=function(e,t,n,i,a){a||(a=e);var s=r.create(),u=new o(4);return(u[0]=(e[0]-i[0])*2/i[2]-1,u[1]=(e[1]-i[1])*2/i[3]-1,u[2]=2*e[2]-1,u[3]=1,r.multiply(n,t,s),r.inverse(s))?(r.multiplyVec4(s,u),0===u[3])?null:(a[0]=u[0]/u[3],a[1]=u[1]/u[3],a[2]=u[2]/u[3],a):null},e.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"},t.create=function(e){var t=new o(9);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]),t},t.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.identity=function(e){return e||(e=t.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.transpose=function(e,t){if(!t||e===t){var r=e[1],n=e[2],o=e[5];return e[1]=e[3],e[2]=e[6],e[3]=r,e[5]=e[7],e[6]=n,e[7]=o,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},t.toMat4=function(e,t){return t||(t=r.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},t.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"},r.create=function(e){var t=new o(16);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},r.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},r.identity=function(e){return e||(e=r.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},r.transpose=function(e,t){if(!t||e===t){var r=e[1],n=e[2],o=e[3],i=e[6],a=e[7],s=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=r,e[6]=e[9],e[7]=e[13],e[8]=n,e[9]=i,e[11]=e[14],e[12]=o,e[13]=a,e[14]=s,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},r.determinant=function(e){var t=e[0],r=e[1],n=e[2],o=e[3],i=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],m=e[10],d=e[11],f=e[12],p=e[13],h=e[14],L=e[15];return f*c*s*o-l*p*s*o-f*a*m*o+i*p*m*o+l*a*h*o-i*c*h*o-f*c*n*u+l*p*n*u+f*r*m*u-t*p*m*u-l*r*h*u+t*c*h*u+f*a*n*d-i*p*n*d-f*r*s*d+t*p*s*d+i*r*h*d-t*a*h*d-l*a*n*L+i*c*n*L+l*r*s*L-t*c*s*L-i*r*m*L+t*a*m*L},r.inverse=function(e,t){t||(t=e);var r,n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],m=e[8],d=e[9],f=e[10],p=e[11],h=e[12],L=e[13],g=e[14],$=e[15],_=n*u-o*s,v=n*l-i*s,E=n*c-a*s,G=o*l-i*u,S=o*c-a*u,x=i*c-a*l,w=m*L-d*h,b=m*g-f*h,F=m*$-p*h,y=d*g-f*L,A=d*$-p*L,T=f*$-p*g,M=_*T-v*A+E*y+G*F-S*b+x*w;return M?(r=1/M,t[0]=(u*T-l*A+c*y)*r,t[1]=(-o*T+i*A-a*y)*r,t[2]=(L*x-g*S+$*G)*r,t[3]=(-d*x+f*S-p*G)*r,t[4]=(-s*T+l*F-c*b)*r,t[5]=(n*T-i*F+a*b)*r,t[6]=(-h*x+g*E-$*v)*r,t[7]=(m*x-f*E+p*v)*r,t[8]=(s*A-u*F+c*w)*r,t[9]=(-n*A+o*F-a*w)*r,t[10]=(h*S-L*E+$*_)*r,t[11]=(-m*S+d*E-p*_)*r,t[12]=(-s*y+u*b-l*w)*r,t[13]=(n*y-o*b+i*w)*r,t[14]=(-h*G+L*v-g*_)*r,t[15]=(m*G-d*v+f*_)*r,t):null},r.toRotationMat=function(e,t){return t||(t=r.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.toMat3=function(e,r){return r||(r=t.create()),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},r.toInverseMat3=function(e,r){var n,o=e[0],i=e[1],a=e[2],s=e[4],u=e[5],l=e[6],c=e[8],m=e[9],d=e[10],f=d*u-l*m,p=-d*s+l*c,h=m*s-u*c,L=o*f+i*p+a*h;return L?(n=1/L,r||(r=t.create()),r[0]=f*n,r[1]=(-d*i+a*m)*n,r[2]=(l*i-a*u)*n,r[3]=p*n,r[4]=(d*o-a*c)*n,r[5]=(-l*o+a*s)*n,r[6]=h*n,r[7]=(-m*o+i*c)*n,r[8]=(u*o-i*s)*n,r):null},r.multiply=function(e,t,r){r||(r=e);var n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],m=e[8],d=e[9],f=e[10],p=e[11],h=e[12],L=e[13],g=e[14],$=e[15],_=t[0],v=t[1],E=t[2],G=t[3],S=t[4],x=t[5],w=t[6],b=t[7],F=t[8],y=t[9],A=t[10],T=t[11],M=t[12],I=t[13],P=t[14],B=t[15];return r[0]=_*n+v*s+E*m+G*h,r[1]=_*o+v*u+E*d+G*L,r[2]=_*i+v*l+E*f+G*g,r[3]=_*a+v*c+E*p+G*$,r[4]=S*n+x*s+w*m+b*h,r[5]=S*o+x*u+w*d+b*L,r[6]=S*i+x*l+w*f+b*g,r[7]=S*a+x*c+w*p+b*$,r[8]=F*n+y*s+A*m+T*h,r[9]=F*o+y*u+A*d+T*L,r[10]=F*i+y*l+A*f+T*g,r[11]=F*a+y*c+A*p+T*$,r[12]=M*n+I*s+P*m+B*h,r[13]=M*o+I*u+P*d+B*L,r[14]=M*i+I*l+P*f+B*g,r[15]=M*a+I*c+P*p+B*$,r},r.multiplyVec3=function(e,t,r){r||(r=t);var n=t[0],o=t[1],i=t[2];return r[0]=e[0]*n+e[4]*o+e[8]*i+e[12],r[1]=e[1]*n+e[5]*o+e[9]*i+e[13],r[2]=e[2]*n+e[6]*o+e[10]*i+e[14],r},r.multiplyVec4=function(e,t,r){r||(r=t);var n=t[0],o=t[1],i=t[2],a=t[3];return r[0]=e[0]*n+e[4]*o+e[8]*i+e[12]*a,r[1]=e[1]*n+e[5]*o+e[9]*i+e[13]*a,r[2]=e[2]*n+e[6]*o+e[10]*i+e[14]*a,r[3]=e[3]*n+e[7]*o+e[11]*i+e[15]*a,r},r.translate=function(e,t,r){var n,o,i,a,s,u,l,c,m,d,f,p,h=t[0],L=t[1],g=t[2];return r&&e!==r?(n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],m=e[8],d=e[9],f=e[10],p=e[11],r[0]=n,r[1]=o,r[2]=i,r[3]=a,r[4]=s,r[5]=u,r[6]=l,r[7]=c,r[8]=m,r[9]=d,r[10]=f,r[11]=p,r[12]=n*h+s*L+m*g+e[12],r[13]=o*h+u*L+d*g+e[13],r[14]=i*h+l*L+f*g+e[14],r[15]=a*h+c*L+p*g+e[15],r):(e[12]=e[0]*h+e[4]*L+e[8]*g+e[12],e[13]=e[1]*h+e[5]*L+e[9]*g+e[13],e[14]=e[2]*h+e[6]*L+e[10]*g+e[14],e[15]=e[3]*h+e[7]*L+e[11]*g+e[15],e)},r.scale=function(e,t,r){var n=t[0],o=t[1],i=t[2];return r&&e!==r?(r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*o,r[5]=e[5]*o,r[6]=e[6]*o,r[7]=e[7]*o,r[8]=e[8]*i,r[9]=e[9]*i,r[10]=e[10]*i,r[11]=e[11]*i,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r):(e[0]*=n,e[1]*=n,e[2]*=n,e[3]*=n,e[4]*=o,e[5]*=o,e[6]*=o,e[7]*=o,e[8]*=i,e[9]*=i,e[10]*=i,e[11]*=i,e)},r.rotate=function(e,t,r,n){var o,i,a,s,u,l,c,m,d,f,p,h,L,g,$,_,v,E,G,S,x,w,b,F,y=r[0],A=r[1],T=r[2],M=Math.sqrt(y*y+A*A+T*T);return M?(1!==M&&(y*=M=1/M,A*=M,T*=M),o=Math.sin(t),a=1-(i=Math.cos(t)),s=e[0],u=e[1],l=e[2],c=e[3],m=e[4],d=e[5],f=e[6],p=e[7],h=e[8],L=e[9],g=e[10],$=e[11],_=y*y*a+i,v=A*y*a+T*o,E=T*y*a-A*o,G=y*A*a-T*o,S=A*A*a+i,x=T*A*a+y*o,w=y*T*a+A*o,b=A*T*a-y*o,F=T*T*a+i,n?e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[0]=s*_+m*v+h*E,n[1]=u*_+d*v+L*E,n[2]=l*_+f*v+g*E,n[3]=c*_+p*v+$*E,n[4]=s*G+m*S+h*x,n[5]=u*G+d*S+L*x,n[6]=l*G+f*S+g*x,n[7]=c*G+p*S+$*x,n[8]=s*w+m*b+h*F,n[9]=u*w+d*b+L*F,n[10]=l*w+f*b+g*F,n[11]=c*w+p*b+$*F,n):null},r.rotateX=function(e,t,r){var n=Math.sin(t),o=Math.cos(t),i=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],m=e[10],d=e[11];return r?e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]):r=e,r[4]=i*o+l*n,r[5]=a*o+c*n,r[6]=s*o+m*n,r[7]=u*o+d*n,r[8]=-(i*n)+l*o,r[9]=-(a*n)+c*o,r[10]=-(s*n)+m*o,r[11]=-(u*n)+d*o,r},r.rotateY=function(e,t,r){var n=Math.sin(t),o=Math.cos(t),i=e[0],a=e[1],s=e[2],u=e[3],l=e[8],c=e[9],m=e[10],d=e[11];return r?e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]):r=e,r[0]=i*o+-(l*n),r[1]=a*o+-(c*n),r[2]=s*o+-(m*n),r[3]=u*o+-(d*n),r[8]=i*n+l*o,r[9]=a*n+c*o,r[10]=s*n+m*o,r[11]=u*n+d*o,r},r.rotateZ=function(e,t,r){var n=Math.sin(t),o=Math.cos(t),i=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],m=e[6],d=e[7];return r?e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]):r=e,r[0]=i*o+l*n,r[1]=a*o+c*n,r[2]=s*o+m*n,r[3]=u*o+d*n,r[4]=-(i*n)+l*o,r[5]=-(a*n)+c*o,r[6]=-(s*n)+m*o,r[7]=-(u*n)+d*o,r},r.frustum=function(e,t,n,o,i,a,s){s||(s=r.create());var u=t-e,l=o-n,c=a-i;return s[0]=2*i/u,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*i/l,s[6]=0,s[7]=0,s[8]=(t+e)/u,s[9]=(o+n)/l,s[10]=-(a+i)/c,s[11]=-1,s[12]=0,s[13]=0,s[14]=-(a*i*2)/c,s[15]=0,s},r.perspective=function(e,t,n,o,i){var a=n*Math.tan(e*Math.PI/360),s=a*t;return r.frustum(-s,s,-a,a,n,o,i)},r.ortho=function(e,t,n,o,i,a,s){s||(s=r.create());var u=t-e,l=o-n,c=a-i;return s[0]=2/u,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/l,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-2/c,s[11]=0,s[12]=-(e+t)/u,s[13]=-(o+n)/l,s[14]=-(a+i)/c,s[15]=1,s},r.lookAt=function(e,t,n,o){o||(o=r.create());var i,a,s,u,l,c,m,d,f,p,h=e[0],L=e[1],g=e[2],$=n[0],_=n[1],v=n[2],E=t[0],G=t[1],S=t[2];return h===E&&L===G&&g===S?r.identity(o):(m=h-E,p=1/Math.sqrt(m*m+(d=L-G)*d+(f=g-S)*f),m*=p,d*=p,f*=p,i=_*f-v*d,(p=Math.sqrt(i*i+(a=v*m-$*f)*a+(s=$*d-_*m)*s))?(i*=p=1/p,a*=p,s*=p):(i=0,a=0,s=0),u=d*s-f*a,(p=Math.sqrt(u*u+(l=f*i-m*s)*l+(c=m*a-d*i)*c))?(u*=p=1/p,l*=p,c*=p):(u=0,l=0,c=0),o[0]=i,o[1]=u,o[2]=m,o[3]=0,o[4]=a,o[5]=l,o[6]=d,o[7]=0,o[8]=s,o[9]=c,o[10]=f,o[11]=0,o[12]=-(i*h+a*L+s*g),o[13]=-(u*h+l*L+c*g),o[14]=-(m*h+d*L+f*g),o[15]=1,o)},r.fromRotationTranslation=function(e,t,n){n||(n=r.create());var o=e[0],i=e[1],a=e[2],s=e[3],u=o+o,l=i+i,c=a+a,m=o*u,d=o*l,f=o*c,p=i*l,h=i*c,L=a*c,g=s*u,$=s*l,_=s*c;return n[0]=1-(p+L),n[1]=d+_,n[2]=f-$,n[3]=0,n[4]=d-_,n[5]=1-(m+L),n[6]=h+g,n[7]=0,n[8]=f+$,n[9]=h-g,n[10]=1-(m+p),n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},r.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"},n.create=function(e){var t=new o(4);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t},n.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.calculateW=function(e,t){var r=e[0],n=e[1],o=e[2];return t&&e!==t?(t[0]=r,t[1]=n,t[2]=o,t[3]=-Math.sqrt(Math.abs(1-r*r-n*n-o*o)),t):(e[3]=-Math.sqrt(Math.abs(1-r*r-n*n-o*o)),e)},n.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},n.inverse=function(e,t){var r=e[0],n=e[1],o=e[2],i=e[3],a=r*r+n*n+o*o+i*i,s=a?1/a:0;return t&&e!==t?(t[0]=-e[0]*s,t[1]=-e[1]*s,t[2]=-e[2]*s,t[3]=e[3]*s,t):(e[0]*=-s,e[1]*=-s,e[2]*=-s,e[3]*=s,e)},n.conjugate=function(e,t){return t&&e!==t?(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t):(e[0]*=-1,e[1]*=-1,e[2]*=-1,e)},n.length=function(e){var t=e[0],r=e[1],n=e[2],o=e[3];return Math.sqrt(t*t+r*r+n*n+o*o)},n.normalize=function(e,t){t||(t=e);var r=e[0],n=e[1],o=e[2],i=e[3],a=Math.sqrt(r*r+n*n+o*o+i*i);return 0===a?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):(a=1/a,t[0]=r*a,t[1]=n*a,t[2]=o*a,t[3]=i*a,t)},n.add=function(e,t,r){return r&&e!==r?(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[3],e)},n.multiply=function(e,t,r){r||(r=e);var n=e[0],o=e[1],i=e[2],a=e[3],s=t[0],u=t[1],l=t[2],c=t[3];return r[0]=n*c+a*s+o*l-i*u,r[1]=o*c+a*u+i*s-n*l,r[2]=i*c+a*l+n*u-o*s,r[3]=a*c-n*s-o*u-i*l,r},n.multiplyVec3=function(e,t,r){r||(r=t);var n=t[0],o=t[1],i=t[2],a=e[0],s=e[1],u=e[2],l=e[3],c=l*n+s*i-u*o,m=l*o+u*n-a*i,d=l*i+a*o-s*n,f=-a*n-s*o-u*i;return r[0]=c*l+-(f*a)+-(m*u)- -(d*s),r[1]=m*l+-(f*s)+-(d*a)- -(c*u),r[2]=d*l+-(f*u)+-(c*s)- -(m*a),r},n.scale=function(e,t,r){return r&&e!==r?(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r):(e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e)},n.toMat3=function(e,r){r||(r=t.create());var n=e[0],o=e[1],i=e[2],a=e[3],s=n+n,u=o+o,l=i+i,c=n*s,m=n*u,d=n*l,f=o*u,p=o*l,h=i*l,L=a*s,g=a*u,$=a*l;return r[0]=1-(f+h),r[1]=m+$,r[2]=d-g,r[3]=m-$,r[4]=1-(c+h),r[5]=p+L,r[6]=d+g,r[7]=p-L,r[8]=1-(c+f),r},n.toMat4=function(e,t){t||(t=r.create());var n=e[0],o=e[1],i=e[2],a=e[3],s=n+n,u=o+o,l=i+i,c=n*s,m=n*u,d=n*l,f=o*u,p=o*l,h=i*l,L=a*s,g=a*u,$=a*l;return t[0]=1-(f+h),t[1]=m+$,t[2]=d-g,t[3]=0,t[4]=m-$,t[5]=1-(c+h),t[6]=p+L,t[7]=0,t[8]=d+g,t[9]=p-L,t[10]=1-(c+f),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.slerp=function(e,t,r,n){n||(n=e);var o,i,a,s,u=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];return Math.abs(u)>=1?(n!==e&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3]),n):(o=Math.acos(u),.001>Math.abs(i=Math.sqrt(1-u*u)))?(n[0]=.5*e[0]+.5*t[0],n[1]=.5*e[1]+.5*t[1],n[2]=.5*e[2]+.5*t[2],n[3]=.5*e[3]+.5*t[3],n):(a=Math.sin((1-r)*o)/i,s=Math.sin(r*o)/i,n[0]=e[0]*a+t[0]*s,n[1]=e[1]*a+t[1]*s,n[2]=e[2]*a+t[2]*s,n[3]=e[3]*a+t[3]*s,n)},n.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},{vec3:e,mat3:t,mat4:r,quat4:n}}();var GLUT={initTime:null,idleFunc:null,displayFunc:null,keyboardFunc:null,keyboardUpFunc:null,specialFunc:null,specialUpFunc:null,reshapeFunc:null,motionFunc:null,passiveMotionFunc:null,mouseFunc:null,buttons:0,modifiers:0,initWindowWidth:256,initWindowHeight:256,initDisplayMode:18,windowX:0,windowY:0,windowWidth:0,windowHeight:0,requestedAnimationFrame:!1,saveModifiers:function(e){GLUT.modifiers=0,e.shiftKey&&(GLUT.modifiers+=1),e.ctrlKey&&(GLUT.modifiers+=2),e.altKey&&(GLUT.modifiers+=4)},onMousemove:function(e){var t=Browser.mouseX,r=Browser.mouseY;Browser.calculateMouseEvent(e);var n=Browser.mouseX,o=Browser.mouseY;(n!=t||o!=r)&&(0==GLUT.buttons&&e.target==Module.canvas&&GLUT.passiveMotionFunc?(e.preventDefault(),GLUT.saveModifiers(e),getWasmTableEntry(GLUT.passiveMotionFunc)(t,r)):0!=GLUT.buttons&&GLUT.motionFunc&&(e.preventDefault(),GLUT.saveModifiers(e),getWasmTableEntry(GLUT.motionFunc)(t,r)))},getSpecialKey:function(e){var t=null;switch(e){case 8:t=120;break;case 46:t=111;break;case 112:t=1;break;case 113:t=2;break;case 114:t=3;break;case 115:t=4;break;case 116:t=5;break;case 117:t=6;break;case 118:t=7;break;case 119:t=8;break;case 120:t=9;break;case 121:t=10;break;case 122:t=11;break;case 123:t=12;break;case 37:t=100;break;case 38:t=101;break;case 39:t=102;break;case 40:t=103;break;case 33:t=104;break;case 34:t=105;break;case 36:t=106;break;case 35:t=107;break;case 45:t=108;break;case 16:case 5:t=112;break;case 6:t=113;break;case 17:case 3:t=114;break;case 4:t=115;break;case 18:case 2:t=116;break;case 1:t=117}return t},getASCIIKey:function(e){if(e.ctrlKey||e.altKey||e.metaKey)return null;var t=e.keyCode;if(48<=t&&t<=57)return t;if(65<=t&&t<=90)return e.shiftKey?t:t+32;if(96<=t&&t<=105)return t-48;if(106<=t&&t<=111)return t-106+42;switch(t){case 9:case 13:case 27:case 32:case 61:return t}var r=e.shiftKey;switch(t){case 186:return r?58:59;case 187:return r?43:61;case 188:return r?60:44;case 189:return r?95:45;case 190:return r?62:46;case 191:return r?63:47;case 219:return r?123:91;case 220:return r?124:47;case 221:return r?125:93;case 222:return r?34:39}return null},onKeydown:function(e){if(GLUT.specialFunc||GLUT.keyboardFunc){var t=GLUT.getSpecialKey(e.keyCode);null!==t?GLUT.specialFunc&&(e.preventDefault(),GLUT.saveModifiers(e),getWasmTableEntry(GLUT.specialFunc)(t,Browser.mouseX,Browser.mouseY)):null!==(t=GLUT.getASCIIKey(e))&&GLUT.keyboardFunc&&(e.preventDefault(),GLUT.saveModifiers(e),getWasmTableEntry(GLUT.keyboardFunc)(t,Browser.mouseX,Browser.mouseY))}},onKeyup:function(e){if(GLUT.specialUpFunc||GLUT.keyboardUpFunc){var t=GLUT.getSpecialKey(e.keyCode);null!==t?GLUT.specialUpFunc&&(e.preventDefault(),GLUT.saveModifiers(e),getWasmTableEntry(GLUT.specialUpFunc)(t,Browser.mouseX,Browser.mouseY)):null!==(t=GLUT.getASCIIKey(e))&&GLUT.keyboardUpFunc&&(e.preventDefault(),GLUT.saveModifiers(e),getWasmTableEntry(GLUT.keyboardUpFunc)(t,Browser.mouseX,Browser.mouseY))}},touchHandler:function(e){if(e.target==Module.canvas){var t=e.changedTouches[0],r="";switch(e.type){case"touchstart":r="mousedown";break;case"touchmove":r="mousemove";break;case"touchend":r="mouseup";break;default:return}var n=document.createEvent("MouseEvent");n.initMouseEvent(r,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(n),e.preventDefault()}},onMouseButtonDown:function(e){if(Browser.calculateMouseEvent(e),GLUT.buttons|=1<<e.button,e.target==Module.canvas&&GLUT.mouseFunc){try{e.target.setCapture()}catch(t){}e.preventDefault(),GLUT.saveModifiers(e),getWasmTableEntry(GLUT.mouseFunc)(e.button,0,Browser.mouseX,Browser.mouseY)}},onMouseButtonUp:function(e){Browser.calculateMouseEvent(e),GLUT.buttons&=~(1<<e.button),GLUT.mouseFunc&&(e.preventDefault(),GLUT.saveModifiers(e),getWasmTableEntry(GLUT.mouseFunc)(e.button,1,Browser.mouseX,Browser.mouseY))},onMouseWheel:function(e){Browser.calculateMouseEvent(e),window.event;var t=-Browser.getMouseWheelDelta(e),r=3;(t=0==t?0:t>0?Math.max(t,1):Math.min(t,-1))<0&&(r=4),GLUT.mouseFunc&&(e.preventDefault(),GLUT.saveModifiers(e),getWasmTableEntry(GLUT.mouseFunc)(r,0,Browser.mouseX,Browser.mouseY))},onFullscreenEventChange:function(e){var t,r;document.fullscreen||document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen?(t=screen.width,r=screen.height):(t=GLUT.windowWidth,r=GLUT.windowHeight,document.removeEventListener("fullscreenchange",GLUT.onFullscreenEventChange,!0),document.removeEventListener("mozfullscreenchange",GLUT.onFullscreenEventChange,!0),document.removeEventListener("webkitfullscreenchange",GLUT.onFullscreenEventChange,!0)),Browser.setCanvasSize(t,r,!0),GLUT.reshapeFunc&&getWasmTableEntry(GLUT.reshapeFunc)(t,r),_glutPostRedisplay()}};function _glutCreateWindow(e){var t={antialias:(128&GLUT.initDisplayMode)!=0,depth:(16&GLUT.initDisplayMode)!=0,stencil:(32&GLUT.initDisplayMode)!=0,alpha:(8&GLUT.initDisplayMode)!=0};return Module.ctx=Browser.createContext(Module.canvas,!0,!0,t),Module.ctx?1:0}function _glutDisplayFunc(e){GLUT.displayFunc=e}function _glutGetModifiers(){return GLUT.modifiers}function _glutInit(e,t){GLUT.initTime=Date.now();var r="ontouchstart"in document.documentElement;r&&(window.addEventListener("touchmove",GLUT.touchHandler,!0),window.addEventListener("touchstart",GLUT.touchHandler,!0),window.addEventListener("touchend",GLUT.touchHandler,!0)),window.addEventListener("keydown",GLUT.onKeydown,!0),window.addEventListener("keyup",GLUT.onKeyup,!0),window.addEventListener("mousemove",GLUT.onMousemove,!0),window.addEventListener("mousedown",GLUT.onMouseButtonDown,!0),window.addEventListener("mouseup",GLUT.onMouseButtonUp,!0),window.addEventListener("mousewheel",GLUT.onMouseWheel,!0),window.addEventListener("DOMMouseScroll",GLUT.onMouseWheel,!0),Browser.resizeListeners.push(function(e,t){GLUT.reshapeFunc&&getWasmTableEntry(GLUT.reshapeFunc)(e,t)}),__ATEXIT__.push(function(){r&&(window.removeEventListener("touchmove",GLUT.touchHandler,!0),window.removeEventListener("touchstart",GLUT.touchHandler,!0),window.removeEventListener("touchend",GLUT.touchHandler,!0)),window.removeEventListener("keydown",GLUT.onKeydown,!0),window.removeEventListener("keyup",GLUT.onKeyup,!0),window.removeEventListener("mousemove",GLUT.onMousemove,!0),window.removeEventListener("mousedown",GLUT.onMouseButtonDown,!0),window.removeEventListener("mouseup",GLUT.onMouseButtonUp,!0),window.removeEventListener("mousewheel",GLUT.onMouseWheel,!0),window.removeEventListener("DOMMouseScroll",GLUT.onMouseWheel,!0),Module.canvas.width=Module.canvas.height=1})}function _glutInitWindowSize(e,t){Browser.setCanvasSize(GLUT.initWindowWidth=e,GLUT.initWindowHeight=t)}function _glutKeyboardFunc(e){GLUT.keyboardFunc=e}function _glutReshapeWindow(e,t){Browser.exitFullscreen(),Browser.setCanvasSize(e,t,!0),GLUT.reshapeFunc&&getWasmTableEntry(GLUT.reshapeFunc)(e,t),_glutPostRedisplay()}function _glutMainLoop(){throw _glutReshapeWindow(Module.canvas.width,Module.canvas.height),_glutPostRedisplay(),"unwind"}function _glutMotionFunc(e){GLUT.motionFunc=e}function _glutMouseFunc(e){GLUT.mouseFunc=e}function _glutReshapeFunc(e){GLUT.reshapeFunc=e}function _glutSwapBuffers(){}function _glutTimerFunc(e,t,r){safeSetTimeout(function(){getWasmTableEntry(t)(r)},e)}function __isLeapYear(e){return e%4==0&&(e%100!=0||e%400==0)}function __arraySum(e,t){for(var r=0,n=0;n<=t;r+=e[n++]);return r}var __MONTH_DAYS_LEAP=[31,29,31,30,31,30,31,31,30,31,30,31],__MONTH_DAYS_REGULAR=[31,28,31,30,31,30,31,31,30,31,30,31];function __addDays(e,t){for(var r=new Date(e.getTime());t>0;){var n=__isLeapYear(r.getFullYear()),o=r.getMonth(),i=(n?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR)[o];if(t>i-r.getDate())t-=i-r.getDate()+1,r.setDate(1),o<11?r.setMonth(o+1):(r.setMonth(0),r.setFullYear(r.getFullYear()+1));else{r.setDate(r.getDate()+t);break}}return r}function _strftime(e,t,r,n){var o=HEAP32[n+40>>2],i={tm_sec:HEAP32[n>>2],tm_min:HEAP32[n+4>>2],tm_hour:HEAP32[n+8>>2],tm_mday:HEAP32[n+12>>2],tm_mon:HEAP32[n+16>>2],tm_year:HEAP32[n+20>>2],tm_wday:HEAP32[n+24>>2],tm_yday:HEAP32[n+28>>2],tm_isdst:HEAP32[n+32>>2],tm_gmtoff:HEAP32[n+36>>2],tm_zone:o?UTF8ToString(o):""},a=UTF8ToString(r),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var u in s)a=a.replace(RegExp(u,"g"),s[u]);var l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c=["January","February","March","April","May","June","July","August","September","October","November","December"];function m(e,t,r){for(var n="number"==typeof e?e.toString():e||"";n.length<t;)n=r[0]+n;return n}function d(e,t){return m(e,t,"0")}function f(e,t){var r;function n(e){return e<0?-1:e>0?1:0}return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function p(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function h(e){var t=__addDays(new Date(e.tm_year+1900,0,1),e.tm_yday),r=new Date(t.getFullYear(),0,4),n=new Date(t.getFullYear()+1,0,4),o=p(r),i=p(n);return 0>=f(o,t)?0>=f(i,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var L={"%a":function(e){return l[e.tm_wday].substring(0,3)},"%A":function(e){return l[e.tm_wday]},"%b":function(e){return c[e.tm_mon].substring(0,3)},"%B":function(e){return c[e.tm_mon]},"%C":function(e){return d((e.tm_year+1900)/100|0,2)},"%d":function(e){return d(e.tm_mday,2)},"%e":function(e){return m(e.tm_mday,2," ")},"%g":function(e){return h(e).toString().substring(2)},"%G":function(e){return h(e)},"%H":function(e){return d(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),d(t,2)},"%j":function(e){return d(e.tm_mday+__arraySum(__isLeapYear(e.tm_year+1900)?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR,e.tm_mon-1),3)},"%m":function(e){return d(e.tm_mon+1,2)},"%M":function(e){return d(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return d(e.tm_sec,2)},"%t":function(){return"	"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),r=0===t.getDay()?t:__addDays(t,7-t.getDay()),n=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(0>f(r,n)){var o=__arraySum(__isLeapYear(n.getFullYear())?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR,n.getMonth()-1)-31;return d(Math.ceil((31-r.getDate()+o+n.getDate())/7),2)}return 0===f(r,t)?"01":"00"},"%V":function(e){var t,r=new Date(e.tm_year+1900,0,4),n=new Date(e.tm_year+1901,0,4),o=p(r),i=p(n),a=__addDays(new Date(e.tm_year+1900,0,1),e.tm_yday);return 0>f(a,o)?"53":0>=f(i,a)?"01":d(Math.ceil((t=o.getFullYear()<e.tm_year+1900?e.tm_yday+32-o.getDate():e.tm_yday+1-o.getDate())/7),2)},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),r=1===t.getDay()?t:__addDays(t,0===t.getDay()?1:7-t.getDay()+1),n=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(0>f(r,n)){var o=__arraySum(__isLeapYear(n.getFullYear())?__MONTH_DAYS_LEAP:__MONTH_DAYS_REGULAR,n.getMonth()-1)-31;return d(Math.ceil((31-r.getDate()+o+n.getDate())/7),2)}return 0===f(r,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t,r=e.tm_gmtoff;return(r>=0?"+":"-")+String("0000"+(r=(r=Math.abs(r)/60)/60*100+r%60)).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var u in L)a.includes(u)&&(a=a.replace(RegExp(u,"g"),L[u](i)));var g=intArrayFromString(a,!1);return g.length>t?0:(writeArrayToMemory(g,e),g.length-1)}function _strftime_l(e,t,r,n){return _strftime(e,t,r,n)}var FSNode=function(e,t,r,n){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=FS.nextInode++,this.name=t,this.mode=r,this.node_ops={},this.stream_ops={},this.rdev=n},readMode=365,writeMode=146;function intArrayFromString(e,t,r){var n=r>0?r:lengthBytesUTF8(e)+1,o=Array(n),i=stringToUTF8Array(e,o,0,o.length);return t&&(o.length=i),o}Object.defineProperties(FSNode.prototype,{read:{get:function(){return(this.mode&readMode)===readMode},set:function(e){e?this.mode|=readMode:this.mode&=~readMode}},write:{get:function(){return(this.mode&writeMode)===writeMode},set:function(e){e?this.mode|=writeMode:this.mode&=~writeMode}},isFolder:{get:function(){return FS.isDir(this.mode)}},isDevice:{get:function(){return FS.isChrdev(this.mode)}}}),FS.FSNode=FSNode,FS.staticInit(),GLImmediate.setupFuncs(),Browser.moduleContextCreatedCallbacks.push(function(){GLImmediate.init()}),Module.requestFullscreen=function e(t,r){Browser.requestFullscreen(t,r)},Module.requestAnimationFrame=function e(t){Browser.requestAnimationFrame(t)},Module.setCanvasSize=function e(t,r,n){Browser.setCanvasSize(t,r,n)},Module.pauseMainLoop=function e(){Browser.mainLoop.pause()},Module.resumeMainLoop=function e(){Browser.mainLoop.resume()},Module.getUserMedia=function e(){Browser.getUserMedia()},Module.createContext=function e(t,r,n,o){return Browser.createContext(t,r,n,o)},GLEmulation.init();var asmLibraryArg={c:_abort,z:_clock_gettime,s:_emscripten_memcpy_big,i:_emscripten_resize_heap,u:_environ_get,v:_environ_sizes_get,B:_exit,w:_fd_close,y:_fd_read,r:_fd_seek,x:_fd_write,b:_glBegin,E:_glClear,o:_glClearColor,G:_glClearDepth,Q:_glColor3d,j:_glColor3f,l:_glDisable,P:_glEnable,d:_glEnd,m:_glLineWidth,f:_glLoadIdentity,g:_glMatrixMode,R:_glOrtho,n:_glPixelStorei,q:_glPointSize,p:_glPopMatrix,U:_glPushMatrix,T:_glScaled,a:_glVertex2fv,e:_glVertex2i,S:_glViewport,D:_gluOrtho2D,M:_glutCreateWindow,K:_glutDisplayFunc,A:_glutGetModifiers,O:_glutInit,N:_glutInitWindowSize,J:_glutKeyboardFunc,F:_glutMainLoop,H:_glutMotionFunc,I:_glutMouseFunc,h:_glutPostRedisplay,L:_glutReshapeFunc,C:_glutSwapBuffers,k:_glutTimerFunc,t:_strftime_l},asm=createWasm(),___wasm_call_ctors=Module.___wasm_call_ctors=function(){return(___wasm_call_ctors=Module.___wasm_call_ctors=Module.asm.W).apply(null,arguments)},_malloc=Module._malloc=function(){return(_malloc=Module._malloc=Module.asm.X).apply(null,arguments)},_main=Module._main=function(){return(_main=Module._main=Module.asm.Y).apply(null,arguments)},___errno_location=Module.___errno_location=function(){return(___errno_location=Module.___errno_location=Module.asm.Z).apply(null,arguments)},stackAlloc=Module.stackAlloc=function(){return(stackAlloc=Module.stackAlloc=Module.asm._).apply(null,arguments)};function ExitStatus(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}var calledMain=!1;function callMain(e){var t=Module._main,r=(e=e||[]).length+1,n=stackAlloc((r+1)*4);HEAP32[n>>2]=allocateUTF8OnStack(thisProgram);for(var o=1;o<r;o++)HEAP32[(n>>2)+o]=allocateUTF8OnStack(e[o-1]);HEAP32[(n>>2)+r]=0;try{var i=t(r,n);return exit(i,!0),i}catch(a){return handleException(a)}finally{calledMain=!0}}function run(e){if(e=e||arguments_,!(runDependencies>0))preRun(),!(runDependencies>0)&&(Module.setStatus?(Module.setStatus("Running..."),setTimeout(function(){setTimeout(function(){Module.setStatus("")},1),t()},1)):t());function t(){!calledRun&&(calledRun=!0,Module.calledRun=!0,ABORT||(initRuntime(),preMain(),Module.onRuntimeInitialized&&Module.onRuntimeInitialized(),shouldRunNow&&callMain(e),postRun()))}}function exit(e,t){EXITSTATUS=e,keepRuntimeAlive()||exitRuntime(),procExit(e)}function procExit(e){EXITSTATUS=e,keepRuntimeAlive()||(Module.onExit&&Module.onExit(e),ABORT=!0),quit_(e,new ExitStatus(e))}if(dependenciesFulfilled=function e(){calledRun||run(),calledRun||(dependenciesFulfilled=e)},Module.run=run,Module.preInit)for("function"==typeof Module.preInit&&(Module.preInit=[Module.preInit]);Module.preInit.length>0;)Module.preInit.pop()();var shouldRunNow=!0;Module.noInitialRun&&(shouldRunNow=!1),run();